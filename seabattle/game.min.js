/*! tweensoft.com 2014-10-16 13:14:54 */
function readStorage(){flag[0]=!1,__open=JSON.parse(window.localStorage.getItem("__open"))?JSON.parse(window.localStorage.getItem("__open")):new Array,numPlay=window.localStorage.getItem("bs_numPlay")?+window.localStorage.getItem("bs_numPlay"):0,money=window.localStorage.getItem("bs_money")?+window.localStorage.getItem("bs_money"):__config.startMoney}function st_getNumPlay(){return numPlay}function st_getMoney(){return money}function st_setNumPlay(a){numPlay+=a,window.localStorage.setItem("bs_numPlay",numPlay)}function st_setMoney(a){money+=a,window.localStorage.setItem("bs_money",money)}function observerStorage(a){obs.push(a)}function factorial(a){return 1>=a?1:a*factorial(a-1)}function getBezierBasis(a,b,c){return factorial(b)/(factorial(a)*factorial(b-a))*Math.pow(c,a)*Math.pow(1-c,b-a)}function ClassBezier(){this.t=1,this.speed=.02,this.arr=[],this.et=null}function Arrow(a){function b(){1==c.scaleX?(c.scaleX=-1,c.x=c.getBounds().width):(c.scaleX=0,c.x=0)}this.initialize();this.mouseChildren=!1;var c=new createjs.Sprite(jsons.JSON1,"btn_arrow");"right"==a&&b();var d=new createjs.Shape;d.graphics.beginFill("#000000").drawRect(0,0,c.getBounds().width,c.getBounds().height),this.hitArea=d,this.addChild(c)}function Button(a,b){this.initialize();var c,d=b?b:1,e=a.pod?a.pod:null;if(e){var f=new createjs.Sprite(jsons["JSON"+d]);f.gotoAndStop(e);var g=a.podScale?a.podScale:1;f.scaleX=f.scaleY=g,this.addChild(f)}var h=a.icon?a.icon:null;if(h){var i=new createjs.Sprite(jsons["JSON"+d]);i.gotoAndStop(h),this.addChild(i)}var j=(a.refTxt?a.refTxt:"Center",a.font?new Text(jsons.JSON2,a.font,a.refTxt,20):null),k=a.txt?a.txt:null;j&&k&&(j.setText(k),j.x=a.txtX?a.txtX/__koefDisplay:this.getBounds().width/2,j.y=a.txtY?a.txtY/__koefDisplay:this.getBounds().height/2-j.getBounds().height,this.addChild(j));var l,m;a.on&&(l=new createjs.Sprite(jsons["JSON"+d]),l.gotoAndStop(a.on),l.x=a.onX?a.onX/__koefDisplay:0,l.y=a.onY?a.onY/__koefDisplay:0,this.addChild(l),a.off&&(m=new createjs.Sprite(jsons["JSON"+d]),m.gotoAndStop(a.off),m.x=a.offX?a.offX/__koefDisplay:0,m.y=a.offY?a.offY/__koefDisplay:0,this.addChild(m)));var n,o;if(a.i){n=new createjs.Sprite(jsons["JSON"+d]),n.gotoAndStop(a.i),this.addChild(n),n.x=a.iconX?a.iconX/__koefDisplay:this.getBounds().width/2-n.getBounds().width/2,n.y=a.iconY?a.iconY/__koefDisplay:this.getBounds().height/2-n.getBounds().height/2;var p=a.iconScale?a.iconScale:1,q=a.iconScaleX?a.iconScaleX:1;n.scaleX=n.scaleY=p,n.scaleX=q,n.rotation=a.rotateIcon?a.rotateIcon:0}if(a.i2){o=new createjs.Sprite(jsons["JSON"+d]),o.gotoAndStop(a.i2),o.x=a.iconX?a.iconX/__koefDisplay:0,o.y=a.iconY?a.iconY/__koefDisplay:0;var p=a.iconScale?a.iconScale:1;o.scaleX=o.scaleY=p,this.addChild(o),o.visible=!1}j&&this.addChild(j),this.changeFrame=function(a,b){"off"==a?(m&&l&&(m.alpha=1,l.alpha=0),n&&o&&(n.visible=!1,o.visible=!0),b&&(this.alpha=.5),c="off"):(m&&l&&(m.alpha=0,l.alpha=1),n&&o&&(n.visible=!0,o.visible=!1),b&&(this.alpha=1),c="on")},this.changeBeetweenAnim=function(){return"off"==c?(this.changeFrame("on"),"on"):(this.changeFrame("off"),"off")},this.setIcon=function(a){1==a?(n.visible=!0,o.visible=!1):(n.visible=!1,o.visible=!0)},this.setText=function(a){j.visible=!0,j.setText(a),-1==a&&(j.visible=!1)}}function FontText(a,b){this.initialize();var c,d=new Array,e=30/__koefDisplay;b&&(c=b),this.setText=function(b,f){if(f||this.removeAllChildren(),"string"==typeof b||"number"==typeof b){for(var g=new createjs.Container,h=b.toString(),i=0,j=f?a.lineHeight*(f-1):0,k=0;k<h.length;k++){d[k]=new createjs.Sprite(new createjs.SpriteSheet(a.ss_font)),d[k].gotoAndStop("f"+h[k]),d[k].x=i,d[k].y=j,g.addChild(d[k]);for(var l=0;l<a.kerning.length;l++)if(a.kerning[l][0]==h[k]&&!a.kerning[l][1]){e=a.kerning[l][2];break}(h.length-(k+1))%3==0&&k+1!=h.length&&"number"==typeof b&&(e=1.5*e),i+=e}g.x=0,"Center"==c&&(g.x=-i/2),this.addChild(g)}else{f=1;for(var l=0;l<b.length;l++)this.setText(b[l],f),f++}},this.setText(0)}function ProgressBar(a,b,c,d){this.initialize();var e,f;a?(b&&(f=jsons[a+__disSuffiks]?new createjs.Sprite(jsons[a+__disSuffiks]):new createjs.Bitmap(images[b]),f.gotoAndStop&&f.gotoAndStop(b),d.alphaPodl&&(f.alpha=d.alphaPodl),this.addChild(f)),e=jsons[a+__disSuffiks]?new createjs.Sprite(jsons[a+__disSuffiks]):new createjs.Bitmap(images[c]),e.gotoAndStop&&e.gotoAndStop(c),this.addChild(e)):(e=c,f=b),e.x="number"==typeof d.xf?d.xf/__koefDisplay:f.getBounds().width/__koefDisplay/2-e.getBounds().width/__koefDisplay/2,e.y="number"==typeof d.yf?d.yf/__koefDisplay:f.getBounds().height/__koefDisplay/2-e.getBounds().height/__koefDisplay/2;var g=e.getBounds().width,h=new createjs.Shape;h.graphics.beginFill("#000000").drawRect(0,0,g,this.getBounds().height),setCoor(h,-g+e.x),h.x=-g+e.x,e.mask=h,this.setLvl=function(a){a>100&&(a=100);var b=g*a/100;h.x=-g+e.x+b},this.gotoLvl=function(a,b){a>100&&(a=100);var c=g*a/100;tw_tweenTo(h,round(-g+e.x+c),h.y,null,b)}}function ResizeTopBottom(a,b){this.initialize();var c=0,d=(__HEIGHTBG-HEIGHTGAME)/2;listenResize(this),this.resize=function(e,f,g,h,i){var i=h/__HEIGHTBG*100,j=100*f/i;c=(j-HEIGHTGAME)/2,c>d&&(c=d),a.y=0-c,b.y=0+c},ResizeGame()}function StoreBoard(a,b){this.initialize();var c,d={time:.2},e=!0,f=0,g=new FontText(b,"Center");setCoor(g,0,0),g.setText(f),this.addChild(g),this.start=function(a){var b=0;e=!1;var h=Math.round((a-f)*round(1/__freq)/d.time);c=function(){if(b+=round(1/__freq),!(f>=a||1==e)){var d=h;f+d>a&&(d=a-f),f+=d,g.setText(f),t_delayOn(round(1/__freq),c)}},t_delayOn(round(1/__freq),c)},this.set=function(a){g.setText(a)},this.stop=function(){e=!0}}function Text(a,b,c,d){this.initialize();var e,f=new Array,g=new createjs.Container,h=30,i=0;this.addChild(g),d&&(h=d),c&&(e=c),this.setText=function(c){g.removeAllChildren();var d=c.toString(),j=Math.floor(d.length/3);d.length%3==0&&j--;for(var k=(d.length-1)*h+j*i,l=d.length-1;l>=0;l--){f[l]||(f[l]=new createjs.Sprite(a)),f[l].gotoAndStop(b+d[l]),d[l]&&1==d[l]&&(k+=5),setCoor(f[l],k),g.addChild(f[l]);var m=0;(d.length-l)%3==0&&(m=i),k-=h+m}"Center"==e&&(g.x=-(h/__koefDisplay/2)*d.length-j/__koefDisplay/2*i)},this.setText(0)}function tw_tweenTo(a,b){if(a.x!=b.x||a.y!=b.y||a.alpha!=b.alpha||a.scaleX!=b.scaleX||a.scaleY!=b.scaleY){var c,d=b.d?b.d:1,e=b.alpha?round(b.alpha):a.alpha,f=b.scaleX?round(b.scaleX):a.scaleX,g=b.scaleY?round(b.scaleY):a.scaleY,h=b.rotate?round(b.rotate):a.rotation,i=b.call?b.call:null,j=b.pars;b.x=b.x?b.x:a.x,b.y=b.y?b.y:a.y;for(var k=(b.x-a.x)/(delay*d),l=(b.y-a.y)/(delay*d),m=(h-a.rotation)/(delay*d),n=(f-a.scaleX)/(delay*d),o=(g-a.scaleY)/(delay*d),p=(e-a.alpha)/(delay*d),q=b.impR?round(b.impR):0,r=!b.mass||b.mass>0?0:l,s=b.delay_koef?b.delay_koef:1,t={o:a,nonSt:b.nonStop,rAl:e,sA:p,rX:b.x,rY:b.y,sX:k,sY:l,mass:b.mass,time:r,del_k:s,rScX:f,rScY:g,sScX:n,sScY:o,impuls:q,rRotate:h,speedRot:m,cb:i,p:j,et:b.everyTick,pet:b.pet,unPause:b.unPause},u=0;u<m_tweem.length;u++)m_tweem[u].o==a&&(m_tweem[u]=t,c=!0);return c||m_tweem.push(t),t_delInTicker(to),t_addToTicker(to),to}}function tw_removeTween(a){for(var b=0;b<m_tweem.length;b++)m_tweem[b].o==a&&m_tweem.splice(b,1)}function tw_removeAllTweens(){m_tweem=new Array,t_delInTicker(to)}function BattleShip(a,b){function c(a,c,d,f){d.setTakes(-1);var g=e(a,c,d,f);d.setTakes(g.i,g.j),b()}function d(a,b,c){if(0>a||a>=i||0>b||b>=i)return!0;var d=K;d=d.concat(R),d=d.concat("user"==c?L:M),d=d.concat("user"==c?N:P),d=d.concat("user"==c?O:Q),c||(d=K,d=d.concat(L),d=d.concat(N),d=d.concat(M),d=d.concat(P));for(var e=0;e<d.length;e++)for(var f=d[e].getTakes(),g=0;g<f.length;g++)if(f[g].i==a&&f[g].j==b)return!0}function e(a,b,c,d){var e=c.getNumDecks(),h=c.getDirection();if(!f(a,b,h,e,d))return{i:a,j:b};for(var j=1;i>j;j++)for(var k=g(-1*j,-1*j,Math.abs(-1*j*2)+1),l=0;l<k.length;l++)if(!f(a+k[l][0],b+k[l][1],h,e,d))return{i:a+k[l][0],j:b+k[l][1]}}function f(a,b,c,e,f){for(var g=e,h=0;e>h;h++)"goriz"==c&&(d(a,b+h,f)||g--),"vert"==c&&(d(a+h,b,f)||g--);return 0==g?!1:!0}function g(a,b,c){for(var d=new Array,e=0;c>e;e++)for(var f=0;c>f;f++){var g=[a+e,b+f];d.push(g)}return d}for(var h=this,i=a.getDimension(),j=__config.time_for_first_step,k="number"==typeof __config.size_field[i].num_deck_1?__config.size_field[i].num_deck_1:0,l="number"==typeof __config.size_field[i].num_deck_2?__config.size_field[i].num_deck_2:0,m="number"==typeof __config.size_field[i].num_deck_3?__config.size_field[i].num_deck_3:0,n="number"==typeof __config.size_field[i].num_mine?__config.size_field[i].num_mine:0,o="number"==typeof __config.size_field[i].num_chests?__config.size_field[i].num_chests:0,p=("number"==typeof __config.size_field[i].num_chest?__config.size_field[i].num_chest:0,0),q=0,r=0,s=0,t=0,u=0,v=0,w=st_getMoney(),x="number"==typeof __config.size_field[i].multibomb?__config.size_field[i].multibomb:__config.multibomb,y="number"==typeof __config.size_field[i].dinamite?__config.size_field[i].dinamite:__config.dinamite,z="number"==typeof __config.size_field[i].periskope?__config.size_field[i].periskope:__config.periskope,A="number"==typeof __config.size_field[i].torpedo?__config.size_field[i].torpedo:__config.torpedo,B=x,C=y,D=z,E=A,F=k,G=l,H=m,I=n,u=n,J=!1,K=new Array,L=new Array,M=new Array,N=new Array,O=new Array,P=new Array,Q=new Array,R=new Array,S=new Array,T=new Array,U=new Array,V=new Array,W=new Array,X=new Array,Y=new Array,Z=0;i>Z;Z++)S[Z]=new Array;this.getData=function(){var a={num_deck1:k,num_deck2:l,num_deck3:m,num_mine:n,num_chests:o,ships_user:L,ships_bot:M,mines_user:N,chest_user:O,mines_bot:P,chest_bot:Q,chests:R,rocks:K,made_moves_user:U,made_moves_bot:T,used_move_user:V,used_move_bot:W,all_shots_user:p,all_shots_bot:q,ship_shots_user:r,ship_shots_bot:s,num_chests_user:t,num_chests_bot:u,periscopes:Y,num_attack:0};return a.multibomb_num_user=x,a.dinamite_num_user=y,a.periskope_num_user=z,a.torpedo_num_user=A,a.multibomb_num_bot=B,a.dinamite_num_bot=C,a.periskope_num_bot=D,a.torpedo_num_bot=E,a.used_objects=X,a.flying_money=J,a.num_money=v,a.num_bot_money=w,a},this.createShip=function(a,b,d,e){switch(a){case 1:"user"==d?k--:F--;break;case 2:"user"==d?l--:G--;break;case 3:"user"==d?m--:H--}var f=new SeaObjects("ship",a,"goriz");"user"==d&&L.push(f),"bot"==d&&M.push(f);var g=Math.floor(i/2)-1,h=Math.floor(i/2)-1;return e&&(g=Math.round(Math.random()*(i-1)),h=Math.round(Math.random()*(i-1))),c(g,h,f,d),0==n&&0==k&&0==l&&0==m&&0==I&&0==F&&0==G&&0==H&&this.randomPlacing(),f},this.changeShipLoc=function(a,b,d,e){c(b,d,a,e)},this.rotateShip=function(a,b){var d=a.getTakes()[0].i,e=a.getTakes()[0].j;c(d,e,a,b)},this.createMine=function(a,b){"user"==a?n--:I--;var d=new SeaObjects("mine",1,"goriz");"user"==a&&N.push(d),"bot"==a&&P.push(d);var e=Math.floor(i/2)-1,f=Math.floor(i/2)-1;b&&(e=Math.round(Math.random()*(i-1)),f=Math.round(Math.random()*(i-1))),c(e,f,d,"user"),0==n&&0==k&&0==l&&0==m&&0==I&&0==F&&0==G&&0==H&&this.randomPlacing()},this.createChest=function(a){var b=new SeaObjects("chest",1,"goriz");"user"==a?(o--,O.push(b)):"bot"==a&&(u--,Q.push(b));var d=Math.round(Math.random()*(i-1)),e=Math.round(Math.random()*(i-1));c(d,e,b,a)},this.randomPlacing=function(b,c){if("user"==b){0!=n||0!=k||0!=l||0!=m||c||(k="number"==typeof __config.size_field[i].num_deck_1?__config.size_field[i].num_deck_1:0,l="number"==typeof __config.size_field[i].num_deck_2?__config.size_field[i].num_deck_2:0,m="number"==typeof __config.size_field[i].num_deck_3?__config.size_field[i].num_deck_3:0,n="number"==typeof __config.size_field[i].num_mine?__config.size_field[i].num_mine:0,L=new Array,N=new Array);for(var d=new Array;n>0;)this.createMine(b,!0);for(;k>0;)d.push(this.createShip(1,"goriz",b,!0));for(;l>0;)d.push(this.createShip(2,"goriz",b,!0));for(;m>0;)d.push(this.createShip(3,"goriz",b,!0));for(var e=0;e<d.length;e++){var f=Math.round(Math.random());1==f&&(d[e].changeDir(),this.rotateShip(d[e],b))}for(;o>0;)this.createChest("user")}else if("bot"==b){if(0==I&&0==F&&0==G&&0==H)return;for(;I>0;)this.createMine(b,!0);for(;F>0;)this.createShip(1,"goriz",b,!0);for(;G>0;)this.createShip(2,"goriz",b,!0);for(;H>0;)this.createShip(3,"goriz",b,!0);for(var e=0;e<M.length;e++){var f=Math.round(Math.random());for(1==f&&(M[e].changeDir(),this.rotateShip(M[e],b));u>0;)this.createChest("bot")}}else h.randomPlacing("user",!0),a.activeReady()},this.getAllTime=function(){return j};var $=!1,_=0;this.after_time=function(){$&&1!=_||(0==_?(a.startTimer(__config.time_for_after_first_step),a.setModal("text_items_placed"),h.randomPlacing("user",!0),$=!0,_++):1==_&&a.nextStep())},this.randomPlacing("bot"),this.createRocks=function(){a.setModal("text_setup_battlefield");for(var b=1;4>=b;b++){var d=new SeaObjects("rock",1,"goriz",b),e=Math.round(Math.random()*(i-1)),f=Math.round(Math.random()*(i-1));K.push(d),c(e,f,d)}},this.setAlphaObjects=function(a){var b=new Array;b=b.concat(L);for(var c=0;c<b.length;c++)b[c].setAlpha(a)}}function BotLogic(a,b,c,d,e,f,g,h,i,j){function k(){for(var a,c=0;c<b.length;c++){var d=p(b[c].i,b[c].j);if(d&&!q(d)&&(a=r(b[c].i,b[c].j)),a)break}(!a||searchObjectWithPar(b,[["i",a.i],["j",a.j]]))&&(a=s());var e=new Array;return e.push(a),e}function l(){if(j>0){if(i.torpedo_num_bot<=0)return;return j--,i.torpedo_num_bot--,o()}if(i.dinamite_num_bot>0){if(i.dinamite_num_bot<=0)return;return f--,i.dinamite_num_bot--,n()}if(i.multibomb_num_bot>0){if(i.multibomb_num_bot<=0)return;return g--,i.multibomb_num_bot--,m()}}function m(){var a=k()[0],b=new Array;if(1==Math.round(Math.random())){for(var c=0;a.i>=u-3||t(a.i,a.j)||t(a.i+1,a.j)||t(a.i+2,a.j);)if(c++,a=s(),c>100)return;b.push(a),b.push({i:a.i+1,j:a.j}),b.push({i:a.i+2,j:a.j})}else{for(var c=0;a.j>=u-3||t(a.i,a.j)||t(a.i,a.j+1)||t(a.i,a.j+2);)if(c++,a=s(),c>100)return;b.push(a),b.push({i:a.i,j:a.j+1}),b.push({i:a.i,j:a.j+2})}return b}function n(){for(var a=k()[0],b=0;a.i>=u-2||a.j>=u-2||t(a.i,a.j)||t(a.i,a.j+1)||t(a.i+1,a.j)||t(a.i+1,a.j+1);)if(b++,a=s(),b>100)return;var c=new Array;return c.push(a),c.push({i:a.i,j:a.j+1}),c.push({i:a.i+1,j:a.j}),c.push({i:a.i+1,j:a.j+1}),c}function o(){for(var a=k()[0],b=0;a.i>=u-2||a.j>=u-2||a.i<1||a.j<1||t(a.i,a.j)||t(a.i-1,a.j)||t(a.i+1,a.j)||t(a.i,a.j-1)||t(a.i,a.j+1);)if(b++,a=s(),b>100)return;var c=new Array;return c.push(a),c.push({i:a.i-1,j:a.j}),c.push({i:a.i+1,j:a.j}),c.push({i:a.i,j:a.j-1}),c.push({i:a.i,j:a.j+1}),c}function p(a,b){for(var d=0;d<c.length;d++)for(var e=c[d].getTakes(),f=0;f<e.length;f++)if(e[f].i==a&&e[f].j==b)return c[d]}function q(a){a.getTakes().length==a.getHits().length}function r(a,c){for(var d=buildMasIndex(a-1,c-1,3),e=0;e<d.length;e++)if(e%2==1&&-1==searchObjectWithPar(b,[["i",d[e][0]],["j",d[e][1]]])&&d[e][0]>=0&&d[e][0]<=u-1&&d[e][1]>=0&&d[e][1]<=u-1)return{i:d[e][0],j:d[e][1]}}function s(){for(var a=Math.round(Math.random()*(u-1)),c=Math.round(Math.random()*(u-1));-1!=searchObjectWithPar(b,[["i",a],["j",c]]);)a=Math.round(Math.random()*(u-1)),c=Math.round(Math.random()*(u-1));return{i:a,j:c}}function t(a,c){var d=new Array;d=d.concat(b);for(var e=0;e<d.length;e++)if(d[e].i==a&&d[e].j==c)return!0}for(var u,v=0;v<h.length;v++)for(var w=h[v].getTakes(),x=0;x<w.length;x++)-1==searchObjectWithPar(b,[["i",w[x].i],["j",w[x].j]])&&b.push(w[x]);this.getTargets=function(){console.log("Money",i.num_bot_money),console.log("Torpedo",i.torpedo_num_bot),console.log("Bomb",i.multibomb_num_bot),console.log("Dynamite",i.dinamite_num_bot),u=a.getDimension();var c=new Array,d=k();c.push(d);for(var e=0;e<d.length;e++)b.push(d[e]);var f=l();if(f){c.push(f);for(var e=0;e<f.length;e++)b.push(f[e])}return c},this.getNumBomb=function(){return f},this.getNumDinamit=function(){return g},this.getNumTorpedo=function(){return j}}function Fight(a,c,d){function e(){{var b=Math.round(3*Math.random());Math.round(Math.random())}2==b&&d.num_bot_money>=__config.price_bonuses.bombs?(d.multibomb_num_bot++,d.num_bot_money-=__config.price_bonuses.bombs):1==b&&d.num_bot_money>=__config.price_bonuses.torpedo?(d.torpedo_num_bot++,d.num_bot_money-=__config.price_bonuses.torpedo):0==b&&d.num_bot_money>=__config.price_bonuses.air_strike?(d.dinamite_num_bot++,d.num_bot_money-=__config.price_bonuses.air_strike):3==b&&d.num_bot_money>=__config.price_bonuses.life&&(a.setLife("bot",1),d.num_bot_money-=__config.price_bonuses.life)}function f(c){var e=new Array,f="user"==c?d.ships_bot:d.ships_user,h="user"==c?d.mines_bot:d.mines_user,i=d.chests;e=e.concat(f),e=e.concat(h),e=e.concat(i);for(var j="user"==c?d.user_targets:d.bot_targets,k=0;k<e.length;k++)for(var l=e[k].getTakes(),m=0;m<l.length;m++)for(var n=0;n<j.length;n++)for(b=0;b<j[n].length;b++)j[n][b].i==l[m].i&&j[n][b].j==l[m].j&&l.length>e[k].getHits().length&&(e[k].setHit(m),"mine"==e[k].getName()&&a.setLife(c,-1),"chest"==e[k].getName()&&g(c))}function g(b){MusicCTRL.play("sound4");var c=Math.round(4*Math.random()),e=a.getData().life_user;0==c?"user"==b?(d.multibomb_num_user++,t_delayOn(.5,function(){v_choiseLocation("bonus",{name:"air_strike",life:e})})):d.multibomb_num_bot++:1==c?"user"==b?(d.dinamite_num_user++,t_delayOn(.5,function(){v_choiseLocation("bonus",{name:"bombs",life:e})})):d.dinamite_num_bot++:2==c?"user"==b?(d.periskope_num_user++,t_delayOn(.5,function(){v_choiseLocation("bonus",{name:"submarine",life:e})})):d.periskope_num_bot++:3==c?(a.setLife(b,1),e=a.getData().life_user,"user"==b&&t_delayOn(.5,function(){v_choiseLocation("bonus",{name:"life",life:e})})):4==c&&("user"==b?(d.torpedo_num_user++,t_delayOn(.5,function(){v_choiseLocation("bonus",{name:"torpedo",life:e})})):d.torpedo_num_bot++)}function h(b){"user"==b?(d.num_money+=__config.price_ship,d.ship_shots_user++):"bot"==b&&(d.num_bot_money+=__config.price_ship_bot,d.ship_shots_bot++),a.setMoney(b,__config.price_ship)}function i(b,e,f,g){function h(){n=Math.round(4*Math.random())+1;for(var a=0;a<l.length;a++)(l[a].getTakes()[0].i==e-1||l[a].getTakes()[0].i==e+1)&&l[a].getKind()==n&&h(),(l[a].getTakes()[0].j==f-1||l[a].getTakes()[0].j==f+1)&&l[a].getKind()==n&&h()}var i="user"==b?d.used_move_user:d.used_move_bot,l=k(i);if("empty"==g){if(!j(i,e,f))var m=new SeaObjects("empty",1,"goriz")}else if("mine"==g){if(!j(i,e,f))var m=new SeaObjects("mine",1,"goriz",null,!0)}else if("chest"==g){if(!j(i,e,f))var m=new SeaObjects("chest",1,"goriz",null,!0)}else if("ship"==g&&"user"==b){var n;if(h(),!j(i,e,f))var m=new SeaObjects("debris",1,"goriz",n,!0);d.flying_money={i:e,j:f},c()}m&&(m.setTakes(e,f),i.push(m)),c(),"mine"==g?a.setModal("text_mine_hit"):"ship"==g&&a.setModal("text_target_hit"),c()}function j(a,b,c){for(var d=0;d<a.length;d++)for(var e=a[d].getTakes(),f=0;f<e.length;f++)if(e[f].i==b&&e[f].j==c)return!0}function k(a){for(var b=new Array,c=0;c<a.length;c++)"debris"==a[c].getName()&&b.push(a[c]);return b}var l="user",m=0;this.getData=function(){var a=d;return a.current_stage=l,a},this.update=function(){f("user"),f("bot")},this.updateView=function(){d.num_attack>=5||("user"==l?a.setModal("text_your_attack"):"bot"==l&&(a.setModal("text_opponents_attack"),d.num_attack++))},this.shotToCell=function(b,c,f,j){var k=j?j:0;"user"==b?d.all_shots_user++:"bot"==b&&d.all_shots_bot++;var l=!1,m=new Array,n="user"==b?d.ships_bot:d.ships_user,o="user"==b?d.mines_bot:d.mines_user,p="user"==b?d.chest_bot:d.chest_user;m=m.concat(n),m=m.concat(o),m=m.concat(p);for(var q=0;q<m.length;q++)for(var r=m[q].getTakes(),s=0;s<r.length;s++)c==r[s].i&&f==r[s].j&&r.length>m[q].getHits().length&&(console.log(m[q].getName()),m[q].setHit(s),i(b,c,f,m[q].getName()),"mine"==m[q].getName()&&a.setLife(b,-1),"chest"==m[q].getName()&&("user"==b?d.num_chests_user++:d.num_chests_bot++,t_delayOn(.5*k+.5,function(){g(b)})),"ship"==m[q].getName()&&h(b,m[q].getTakes().length),l=!0);"bot"==b&&e(),l||i(b,c,f,"empty");for(var t=!0,u=0;u<n.length;u++)n[u].getTakes().length>n[u].getHits().length&&(t=!1);t&&t_delayOn(2,function(){t_allInPause();var a=0==d.ship_shots_user?0:Math.round(d.ship_shots_user/d.all_shots_user*100),c=0==d.ship_shots_bot?0:Math.round(d.ship_shots_bot/d.all_shots_bot*100),e="user"==b?"text_red_victory":"text_red_you_lose";v_choiseLocation("gameOver",{title:e,hit_rate_user:a,hit_rate_bot:c,treasures_user:d.num_chests_user,treasures_bot:d.num_chests_bot,num_money:d.num_money,reason:"sunk"}),MusicCTRL.play("user"==b?"sound6":"sound3")})},this.changeCurrentPlayer=function(){m++,l=m>=2?null:"user"==l?"bot":"user",this.updateView(),c()},this.setAlphaObjects=function(a){var b=new Array;b=b.concat(d.ships_user);for(var c=0;c<b.length;c++)b[c].setAlpha(a)},this.getAllTime=function(){return 0},this.after_time=function(){}}function LogicGame(a){function b(a,b){for(var c=0;c<r.length;c++)r[c].notify&&!a&&r[c].notify(),r[c].notifyInterface&&!b&&r[c].notifyInterface()}function c(a,c){if(t_delInPause(s),t_delInTicker(s),v=!1,0!=a){time=a+1;var d=function(){return 0>=time?(c(),void b()):(v||time--,b(!0),void(s=t_delayOn(1,d)))};d()}}function d(){v=!0}var e,f,g,h,i,j,k,l,m,n,o,p,q=this,r=new Array,s=null,t=a;this.getDimension=function(){return t};var u=new BattleShip(this,b);this.init=function(a){n=1,e=1,m=st_getMoney(),f="real",o=!1,g=!1,time=-1,h=__config.lifes,i=__config.lifes,j=null,k=null,l=null,p=a,c(u.getAllTime(),u.after_time),u.createRocks()},this.registerObservers=function(a){-1==indexOf(r,a)&&r.push(a)},this.pause=function(){},this.changeScale=function(){n=1==n?.5:1,o=1==n?!1:!0,b()},this.changeView=function(){f="transp"==f?"real":"transp",this.updateView()},this.updateView=function(){var a="real"==f?!0:!1;u.setAlphaObjects&&u.setAlphaObjects(a),b()},this.createShip=function(a,b){u.createShip(a,b,"user")},this.changeShipLoc=function(a,b,c){u.changeShipLoc(a,b,c,"user")},this.rotateShip=function(a){u.rotateShip(a,"user")},this.createMine=function(){u.createMine("user")},this.randomPlacing=function(){u.randomPlacing("user")},this.createTarget=function(){u.createTarget("user")},this.createBonus=function(a){u.createBonus(a,"user")},this.deActiveBonus=function(a){u.deActiveBonus(a)},this.nextStep=function(){t_delInTicker(s),g=!1,time=-1;var a=u.getData();3==e?e=2:e++,2==e&&(u=new TargetSelection(this,b,a),c(u.getAllTime(),u.after_time),a.num_attack<5&&this.setModal("text_place_your_target"),this.createTarget()),3==e&&(u.calculation(),a=u.getData(),u=new Fight(this,b,a),u.updateView(),this.updateView(),p=!1),b()},this.startTimer=function(a,b){time=-1,c(a,b)},this.activeReady=function(){g=!0,b()},this.deActiveReady=function(){g=!1,b()},this.activePeriskop=function(){u.goPeriskope()},this.setModal=function(a,e){j=a,k=e,j?d():c(u.getAllTime(),u.after_time),b()},this.setMoney=function(a,b){"user"==a&&(m+=b),st_setMoney(b)},this.shot=function(a,c,d,e){u.shotToCell(d,a,c,e),b()},this.changeCurrentPlayer=function(){u.changeCurrentPlayer()},this.resetOnlyReady=function(){k=null},this.setLife=function(a,c){"user"==a?h+=c:i+=c,(0>=h||0>=i)&&(t_allInPause(),t_delayOn(2,function(){var b=u.getData(),c=0==b.ship_shots_user?0:Math.round(b.ship_shots_user/b.all_shots_user*100),d=0==b.ship_shots_bot?0:Math.round(b.ship_shots_bot/b.all_shots_bot*100),e="user"==a?"text_red_you_lose":"text_red_victory";v_choiseLocation("gameOver",{title:e,hit_rate_user:c,hit_rate_bot:d,treasures_user:b.num_chests_user,treasures_bot:b.num_chests_bot,num_money:b.num_money,reason:"life_lost"}),MusicCTRL.play("user"==a?"sound3":"sound6")})),b()},this.setNumBonus=function(a,c,d){"user"==a&&("multibomb"==c&&(q.getData().game_data.multibomb_num_user+=d),"dinamite"==c&&(q.getData().game_data.dinamite_num_user+=d),"periscope"==c&&(q.getData().game_data.periskope_num_user+=d),"torpedo"==c&&(q.getData().game_data.torpedo_num_user+=d)),b()},this.pause=function(){d()},this.unPause=function(){v=!1},this.getData=function(){var a={cur_step:e,cur_ship:f,ready:g,game_data:u.getData(),time:time,life_user:h,life_bot:i,modal:j,only_ready:k,center_target:l,user_money:m,scale_field:n,loupe_active:o};return a},this.setTutorial=function(){if(p)for(var a=0;a<r.length;a++)r[a].setTutorial&&r[a].setTutorial(!0)};var v=!1}function SeaObjects(a,b,c,d,e){function f(){if("debris"==a&&(h=new Mine(i,"debris",d),h.setStartCoor(field_params.startX_debris_1,field_params.startY_debris_1),h.mouseEnabled=!1),"empty"==a&&(h=new Mine(i),h.setGraphics(jsons.JSON1,"miss"),h.setStartCoor(field_params.startX_empty,field_params.startY_empty),h.mouseEnabled=!1),"ship"==a&&(h=new Ship(b,c,i)),"mine"==a&&(h=new Mine(i),h.setGraphics(jsons.JSON4,"floating-bomb-anim",!0),e&&(h.clearGraphics(),h.setGraphics(jsons.JSON2,"mine",!0),h.mouseEnabled=!1)),"chest"==a&&(h=new Mine(i,"chest_on"),e&&(h.setGraphics(jsons.JSON1,"chest_off",!0),h.mouseEnabled=!1),h.setStartCoor(field_params.startX_chest,field_params.startY_chest)),"anim-target"==a&&(h=new Mine(i),h.setGraphics(jsons.JSON4,"anim-target",!0),h.setStartCoor(field_params.startX_terget,field_params.startY_terget)),"bomb"==a&&(h=new Mine(i),h.setGraphics(jsons.JSON4,"anim-target",!0,field_params.dx*__koefDisplay*1+field_params.dx*__koefDisplay*0,-field_params.dy*__koefDisplay*1+field_params.dy*__koefDisplay*0),h.setGraphics(jsons.JSON4,"anim-target",!0,field_params.dx*__koefDisplay*1+field_params.dx*__koefDisplay*1,-field_params.dy*__koefDisplay*1+field_params.dy*__koefDisplay*1),h.setGraphics(jsons.JSON4,"anim-target",!0),h.setGraphics(jsons.JSON4,"anim-target",!0,field_params.dx*__koefDisplay*0+field_params.dx*__koefDisplay*1,-field_params.dy*__koefDisplay*0+field_params.dy*__koefDisplay*1),h.setStartCoor(field_params.startX_terget,field_params.startY_terget)),"dinamite"==a&&(h=new Mine(i),h.setGraphics(jsons.JSON4,"anim-target",!0,field_params.dx*__koefDisplay*2+field_params.dx*__koefDisplay*0,-field_params.dy*__koefDisplay*2+field_params.dy*__koefDisplay*0),h.setGraphics(jsons.JSON4,"anim-target",!0,field_params.dx*__koefDisplay*1+field_params.dx*__koefDisplay*0,-field_params.dy*__koefDisplay*1+field_params.dy*__koefDisplay*0),h.setGraphics(jsons.JSON4,"anim-target",!0),h.setStartCoor(field_params.startX_terget,field_params.startY_terget)),"periskop"==a&&(h=new Mine(i),h.setGraphics(jsons.JSON1,"submarine_area1",!0),h.setStartCoor(field_params.startX_per,field_params.startY_per)),"torpedo"==a){var f=new Mine(i);f.setGraphics(jsons.JSON4,"anim-target",!0,field_params.dx*__koefDisplay*0+field_params.dx*__koefDisplay*-1,-field_params.dy*__koefDisplay*0+field_params.dy*__koefDisplay*-1),f.setCell(-1,0);var g=new Mine(i);g.setGraphics(jsons.JSON4,"anim-target",!0,field_params.dx*__koefDisplay*1+field_params.dx*__koefDisplay*0,-field_params.dy*__koefDisplay*1+field_params.dy*__koefDisplay*0),g.setGraphics(jsons.JSON4,"anim-target",!0),g.setGraphics(jsons.JSON4,"anim-target",!0,field_params.dx*__koefDisplay*-1+field_params.dx*__koefDisplay*0,-field_params.dy*__koefDisplay*-1+field_params.dy*__koefDisplay*0),g.setCell(0,-1),g.setCell(0,0),g.setCell(0,1);var j=new Mine(i);j.setGraphics(jsons.JSON4,"anim-target",!0,field_params.dx*__koefDisplay*0+field_params.dx*__koefDisplay*1,-field_params.dy*__koefDisplay*0+field_params.dy*__koefDisplay*1),j.setCell(1,0),g.setListener(f,j),f.setListener(g,j),j.setListener(f,g),h=new Array,h.push(f),h.push(g),h.push(j);for(var k=0;k<h.length;k++)h[k].setStartCoor(field_params.startX_terget,field_params.startY_terget)}"part_ship"==a&&(h=new Mine(i,"hit_area"),h.mouseChildren=!1,h.mouseEnabled=!1,h.setStartCoor(field_params.startX_flag,field_params.startY_flag)),"rock"==a&&(h=new Mine(i),h.setGraphics(jsons.JSON2,"rock_"+d),(1==d||3==d)&&h.setStartCoor(12/__koefDisplay,481/__koefDisplay),2==d&&h.setStartCoor(11/__koefDisplay,483/__koefDisplay),4==d&&h.setStartCoor(20/__koefDisplay,484/__koefDisplay),h.mouseEnabled=!1,h.mouseChildren=!1)}function g(a){h.clearGraphics(),"vert"==a?(h.setGraphics(jsons.JSON4,"anim-target",!0),h.setGraphics(jsons.JSON4,"anim-target",!0,0*field_params.dx+1*field_params.dx,0*-field_params.dy+1*field_params.dy),h.setGraphics(jsons.JSON4,"anim-target",!0,0*field_params.dx+2*field_params.dx,0*-field_params.dy+2*field_params.dy)):"goriz"==a&&(h.setGraphics(jsons.JSON4,"anim-target",!0,2*field_params.dx+0*field_params.dx,2*-field_params.dy+0*field_params.dy),h.setGraphics(jsons.JSON4,"anim-target",!0,1*field_params.dx+0*field_params.dx,1*-field_params.dy+0*field_params.dy),h.setGraphics(jsons.JSON4,"anim-target",!0))}var h,i=this,j=new Array,k=new Array,l=new Array,m=!1;f(),this.getTakes=function(){return j},this.getHits=function(){return k},this.getName=function(){return a},this.getKind=function(){return d},this.getVisual=function(){return h},this.getDirection=function(){return h.getDirect()},this.getNumDecks=function(){return b},this.changeDir=function(){h.changeDir(),"dinamite"==a&&g(h.getDirect())},this.setAlpha=function(a){h.setAlpha(a)},this.setVisible=function(a){h.setGraphics(jsons.JSON1,a,!0)},this.clearVisible=function(){h.clearGraphics()},this.dontMouseTouch=function(){m=!0},this.hits=new Array,this.setHit=function(c){if(this.hits.push(c),k.push(c),"mine"==a)h.clearGraphics(),h.setGraphics(jsons.JSON1,"mine",!0);else if("ship"==a){var d=new createjs.Sprite(jsons.JSON4,"fire");d.play();var e=!1;1==b&&(h.setGraphics("1ship_black"),e||setCoor(d,-49,-111),e=!0),2==b?(-1!=indexOf(k,0)&&("goriz"==this.getDirection()?(h.setGraphics("1ship_black1"),0==c&&setCoor(d,-53,-82),e=!0):(h.setGraphics("1ship_black2"),0==c&&setCoor(d,-50,-77),e=!0)),-1!=indexOf(k,1)&&("goriz"==this.getDirection()?(h.setGraphics("1ship_black2"),1==c&&setCoor(d,-24,-110),e=!0):(h.setGraphics("1ship_black1"),1==c&&setCoor(d,-24,-50),e=!0))):3==b&&(-1!=indexOf(k,0)&&h.setGraphics("goriz"==this.getDirection()?"3ship_black1":"3ship_black3"),-1!=indexOf(k,1)&&h.setGraphics("3ship_black2"),-1!=indexOf(k,2)&&h.setGraphics("goriz"==this.getDirection()?"3ship_black3":"3ship_black1"),-1!=indexOf(k,0)&&-1!=indexOf(k,1)&&h.setGraphics("goriz"==this.getDirection()?"3ship_black1-2":"3ship_black2-3"),-1!=indexOf(k,1)&&-1!=indexOf(k,2)&&h.setGraphics("goriz"==this.getDirection()?"3ship_black2-3":"3ship_black1-2"),-1!=indexOf(k,0)&&-1!=indexOf(k,2)&&h.setGraphics("3ship_black1-3")),k.length==b&&h.setGraphics(b+"ship_black"),3==b&&(0==c&&("goriz"==this.getDirection()?(e||setCoor(d,-26,-46),e=!0):(e||setCoor(d,-43,-29),e=!0)),1==c&&("goriz"==this.getDirection()?(e||setCoor(d,-13,-79),e=!0):(e||setCoor(d,-12,-13),e=!0)),2==c&&("goriz"==this.getDirection()?(e||setCoor(d,21,-98),e=!0):(e||setCoor(d,21,22),e=!0))),d.cache(0,0,176/__koefDisplay,176/__koefDisplay),t_addToTicker(function(){d.updateCache()}),l.push(d);for(var f=0;f<l.length;f++)h.addChild(l[f]),h.mouseChildren=!0}},this.take_c=j,this.setTakes=function(a,c,d){var e=new Array;if(-1!=a||d||(j=e,this.take_c=e),d)return j.push({i:a,j:c}),void(this.take_c=j);var f;f=h[0]?h[0]:h;for(var g=0;b>g;g++){if("goriz"==f.getDirect()){var i={i:a,j:c+g};e.push(i)}if("vert"==f.getDirect()){var i={i:a+g,j:c};e.push(i)}}j=e,this.take_c=e},this.setMouseEnabled=function(b){"part_ship"==a||"rock"==a||"debris"==a||"empty"==a||"chest"==a||"mine"==a&&e||m||(h.mouseEnabled=b)}}function TargetSelection(a,b,c){function d(a,b,c,d){if("user"==d){console.log(c),"ship"==c&&(c="part_ship");var e=new SeaObjects(c,1,"goriz");e.setTakes(a,b),z.push(e)}}function e(a,c,d,e){var f=g(a,c,d,e);d.setTakes(-1),k(f.i,f.j,d),b()}function f(a){for(var b=0;b<v.length;b++)a?"anim-target"==v[b].getName()&&(v.splice(b,1),b--):("bomb"==v[b].getName()||"dinamite"==v[b].getName()||"periskop"==v[b].getName()||"torpedo"==v[b].getName())&&(v.splice(b,1),b--)}function g(a,b,c,d,e){if(!h(a,b,c,d,e))return{i:a,j:b};for(var f=1;B>f;f++)for(var i=j(-1*f,-1*f,Math.abs(-1*f*2)+1),k=0;k<i.length;k++)if(!h(a+i[k][0],b+i[k][1],c,d,e))return{i:a+i[k][0],j:b+i[k][1]};return e?void 0:g(a,b,c,d,!0)}function h(a,b,c,d,e){for(var f=c.getTakes(),g=c.getTakes().length,h=g,j=0;g>j;j++)i(a+(f[j].i-f[0].i),b+(f[j].j-f[0].j),c,d,e)||h--;return 0==h?!1:!0}function i(a,b,d,e,f){if(0>a||a>=B||0>b||b>=B)return!0;var g=c.rocks;f||(g=g.concat(c.used_move_user)),g=g.concat("user"==e?v:w);for(var h=0;h<g.length;h++){var i=g[h].getTakes();if(g[h]!=d)for(var j=0;j<i.length;j++)if(i[j].i==a&&i[j].j==b)return!0}}function j(a,b,c){for(var d=new Array,e=0;c>e;e++)for(var f=0;c>f;f++){var g=[a+e,b+f];
d.push(g)}return d}function k(a,b,c){if("anim-target"==c.getName())c.setTakes(a,b);else if("bomb"==c.getName())c.setTakes(a,b),c.setTakes(a+0,b+1,!0),c.setTakes(a+1,b+0,!0),c.setTakes(a+1,b+1,!0);else if("dinamite"==c.getName()){var d=c.getDirection();c.setTakes(a,b),"goriz"==d?(c.setTakes(a+0,b+1,!0),c.setTakes(a+0,b+2,!0)):"vert"==d&&(c.setTakes(a+1,b+0,!0),c.setTakes(a+2,b+0,!0))}else"periskop"==c.getName()?(c.setTakes(a,b),c.setTakes(a+0,b+1,!0),c.setTakes(a+1,b+0,!0),c.setTakes(a+1,b+1,!0)):"torpedo"==c.getName()&&(c.setTakes(a,b),c.setTakes(a+0,b-1,!0),c.setTakes(a+1,b+0,!0),c.setTakes(a-1,b+0,!0),c.setTakes(a+0,b+1,!0))}var l,m,n,o,p=this,q=__config.time_for_second_step,r=!1,s=new Array,t=new Array,u=!1,v=new Array,w=new Array,x=null,y=null,z=new Array,A=new Array,B=a.getDimension();this.getData=function(){var a=c;return a.target_user=l,a.target_bot=m,a.selected_objects=v,a.bot_selected_objects=w,a.periskop_active=x,a.periskop2=y,a.periskop_view_user=z,a.periskop_view_bot=A,a.bot_targets=s,a.user_targets=t,a},this.createTarget=function(c){if(!u&&"user"==c){var d=Math.floor(B/2)-1,g=Math.floor(B/2)-1;f(!0),l=new SeaObjects("anim-target",1,"goriz"),l.setTakes(d,g),e(d,g,l,c),v.push(l),a.activeReady(),r=!0,b()}},this.createBonus=function(c,d){if(!u&&"user"==d){r||l||a.deActiveReady();var g=Math.floor(B/2)-1,h=Math.floor(B/2)-1;f();var i=new SeaObjects(c,1,"goriz");k(g,h,i),e(g,h,i,d),v.push(i),"periskop"==c&&(n=i,a.activeReady()),b()}},this.deActiveBonus=function(a){if(!u){f();for(var c=0;c<v.length;c++)v[c].getName()==a&&v(c,1);b()}},this.changeShipLoc=function(a,b,c,d){e(b,c,a,d)},this.rotateShip=function(a,b){var c=a.getTakes()[0].i,d=a.getTakes()[0].j;"dinamite"==a.getName()&&(a.changeDir(),e(c,d,a,b)),e(c,d,a,b)},this.getAllTime=function(){return q};var C=!1;this.after_time=function(){if(!C){if(c.num_attack<5&&a.setModal("text_target_placed",!0),!l){p.createTarget("user");var b=Math.round(Math.random()*(B-1)),d=Math.round(Math.random()*(B-1));p.changeShipLoc(l,b,d,"user")}a.activeReady(),r=!0,C=!0,a.nextStep()}},this.calculation=function(){for(var a=new BotLogic(p,c.made_moves_bot,c.ships_user,c.mines_user,c.chests,c.multibomb_num_bot,c.dinamite_num_bot,c.rocks,c,c.torpedo_num_bot),b=0;b<v.length;b++)"periskop"!=v[b].getName()&&t.push(v[b].getTakes());for(var b=0;b<t.length;b++)3==t[b].length&&c.dinamite_num_user--,4==t[b].length&&c.multibomb_num_user--,5==t[b].length&&c.torpedo_num_user--;s=a.getTargets(),dinamite_num_bot=a.getNumDinamit(),multibomb_num_bot=a.getNumBomb(),torpedo_num_bot=a.getNumTorpedo()},this.goPeriskope=function(){u=!0,a.pause(),y=!0,x=function(){for(var e="user",g="user"==e?n:o,h="user"==e?c.ships_bot:c.ships_user,i="user"==e?c.mines_bot:c.mines_user,j="user"==e?c.chest_bot:c.chest_user,k=0;k<g.getTakes().length;k++){var l=g.getTakes()[k].i,m=g.getTakes()[k].j,p=new Array;p=p.concat(h),p=p.concat(i),p=p.concat(j);for(var q=0;q<p.length;q++)for(var s=p[q].getTakes(),t=0;t<s.length;t++)s[t].i==l&&s[t].j==m&&d(l,m,p[q].getName(),e)}if(r||a.deActiveReady(),"user"==e){y=null;for(var w=0;w<v.length;w++)"periskop"==v[w].getName()&&-1==indexOf(c.used_objects,v[w])&&(c.periscopes.push(v[w]),v.splice(w,1));t_delayOn(__config.time_for_periscope,function(){x=null,c.periskope_num_user--,z=new Array,f(),u=!1,a.unPause(),b()})}else periskope_num_bot--;b()},b()},this.getDimension=function(){return B}}function init(){readStorage(),st_getNumPlay()%__config.add2home==0&&ADD_TO_HOME(),v_initLocations(),v_choiseLocation("menu"),MusicCTRL.on("sound",1),MusicCTRL.on("music"),MusicCTRL.play("music")}function ViewModelGame(a){function b(){for(var a=0;a<c.length;a++)c[a].updateField&&c[a].updateField(e.cur_step)}var c=new Array,d=a,e=d.getData();d.registerObservers(this),this.registerObservers=function(a){c.push(a)};var f=new VisualGame(this,d.getDimension());this.notify=function(){e=d.getData(),b()},this.setToCell=function(a,b,c){d.changeShipLoc(a,b,c)},this.rotateShip=function(a,b){d.rotateShip(a,b)},this.shot=function(a,b,c,e){d.shot(a,b,c,e)},this.changeCurrentPlayer=function(){d.changeCurrentPlayer()},this.nextStep=function(){d.nextStep()},this.getVisual=function(){return f},this.getData=function(){return e},this.getDimension=function(){return d.getDimension()}}function ViewModelInterface(a){function b(){for(var a=0;a<h.length;a++)h[a].updateTopIface&&h[a].updateTopIface()}function c(){for(var a=0;a<h.length;a++)h[a].updateBottomIface&&h[a].updateBottomIface()}function d(){for(var a=0;a<h.length;a++)h[a].updateIface&&h[a].updateIface()}function e(a){if(k.graphics.clear(),a){var b=g.getData();k.graphics.beginFill("#000000").drawRect(0,0,WIDTHGAME,HEIGHTGAME),k.alpha=.01,l.startTutorial(b.cur_step)}}var f=this,g=a,h=new Array,i=!1,j=g.getData();g.registerObservers(this);var k=new createjs.Shape;k.addEventListener("click",function(){var a=g.getData();l.nextHint(a.cur_step)}),this.registerObservers=function(a){h.push(a)};var l=new VisualInterface(this);this.notifyInterface=function(){j=g.getData(),d(),b(),c()},this.randomClick=function(){g.randomPlacing()},this.pauseClick=function(){i?t_delAllInPause():(t_allInPause(),v_choiseLocation("pause")),i=i?!1:!0},this.shipClick=function(){g.changeView()},this.readyClick=function(){if(j.game_data.selected_objects)for(var a=j.game_data.selected_objects,b=0;b<a.length;b++)if("periskop"==a[b].getName())return void(j.game_data.periskop_active||g.activePeriskop());g.nextStep()},this.clickOnLoupe=function(){g.changeScale()},this.clickOnMoney=function(){this.pauseClick(),v_choiseLocation("shop",{logic:g,notify:f.notifyInterface})},this.clickOnShip=function(a){g.createShip(a)},this.clickOnMine=function(){g.createMine()},this.clickOnBonus=function(a){for(var b=g.getData(),c=0;c<b.game_data.selected_objects.length;c++)if(b.game_data.selected_objects[c].getName()==a)return void g.deActiveBonus(a);g.createBonus(a)},this.clickOnTarget=function(){g.createTarget()},this.modalClose=function(){("text_setup_battlefield"==j.modal||"text_place_your_target"==j.modal)&&g.setTutorial(),g.setModal(null,j.only_ready),g.resetOnlyReady()},this.setTutorial=function(a){e(a)},this.getVisual=function(){return l},this.getTutorial=function(){return k},this.getData=function(){return j},b(),c()}function FloatFrame(){var a=new createjs.Container,b=new createjs.Container;FloatFrame.superclass.constructor.apply(this,[a,b]);var c=new createjs.Sprite(jsons.JSON2,"window_top_640x600"),d=new createjs.Sprite(jsons.JSON2,"window_bottom");setCoor(d,0,380),a.addChild(c),b.addChild(d),this.addChild(a),this.addChild(b),this.addToTopPlatform=function(b,c){"number"==typeof c?a.addChildAt(b,c):a.addChild(b)},this.addToBottomPlatform=function(a,c){"number"==typeof c?b.addChildAt(a,c):b.addChild(a)}}function VisualGame(a,b){function c(){p.mouseEnable=!0,p.mouseChildren=!0}function d(){p.mouseEnable=!1,p.mouseChildren=!1}function e(){p.removeAllEventListeners(),p.addEventListener("mousedown",function(){t_delInTicker(i),h=-1;var b=function(){var c=a.getData();h++,h>=1?j?(t_delAllInPause(),k||p.removeEvents(),j=!1,console.log("unPause")):3==c.cur_step&&(t_allInPause(),p.addEvents(!0),j=!0,console.log("pause")):i=t_delayOn(1,b)};b()}),p.addEventListener("pressup",function(){t_delInTicker(i)})}this.initialize();var f,g,h,i,j,k,l,m,n,o,p=this,q=new Field(this,a,b),r=new createjs.Shape;r.graphics.beginFill("#000000").drawRect(0,0,WIDTHGAME,HEIGHTGAME),r.alpha=.01,this.addChild(r),this.addChild(q),a.registerObservers(this),this.updateField=function(){var f=a.getData();3==f.cur_step&&"bot"==f.game_data.current_stage?e():p.removeAllEventListeners();var g=f.scale_field;16==b&&(l=1==g?-700:-40,m=1==g?38:70,n=1==g?-402:88,o=1==g?136:170),12==b&&(l=1==g?-405:-2,m=1==g?38:175,n=1==g?-315:38,o=1==g?36:180),10==b&&(l=1==g?-227:17,m=1==g?38:292,n=1==g?-238:12,o=1==g?-13:182),a.getData().only_ready?d():c()},this.removeEvents=function(a){a||(k=!1),q.removeAllEventListeners()},this.addEvents=function(b){b||(k=!0),q.addEventListener("mousedown",function(a){f=a.stageX,g=a.stageY}),q.addEventListener("pressmove",function(b){var c=(a.getData(),1);tw_removeTween(q),q.x+(b.stageX-f)/c<m/__koefDisplay&&q.x+(b.stageX-f)/c>l/__koefDisplay&&(q.x+=(b.stageX-f)/c,f=b.stageX),q.y+(b.stageY-g)/c<o/__koefDisplay&&q.y+(b.stageY-g)/c>n/__koefDisplay&&(q.y+=(b.stageY-g)/c,g=b.stageY)})},this.addEvents()}function VisualInterface(a){function b(){e.enableAll(),e.mouseEnable=!0,f.mouseEnable=!0,e.mouseChildren=!0,f.mouseChildren=!0}function c(){e.mouseEnable=!1,f.mouseEnable=!1,e.mouseChildren=!1,f.mouseChildren=!1}function d(){e.mouseEnable=!0,e.mouseChildren=!0,e.onlyreadyEnable()}this.initialize();var e,f,g,h,i,j=this,k=!1,l=0,m=(__HEIGHTBG-HEIGHTGAME)/2,n=(new Array,new createjs.Container),o=new createjs.Sprite(jsons.JSON1);o.gotoAndStop("area_money"),setCoor(o,-108,115);var p=new Button({pod:"btn_money",i:"icon_money",iconX:-1,iconY:1,txt:"0",font:"numbers_green_small_",txtX:99,txtY:42,refTxt:"Left"});setCoor(p,-2,84),p.addEventListener("click",function(){a.clickOnMoney()}),e=new TopInterface(a,o,p),f=new BottomInterface(a);var q=new FloatFrame;n.addChild(o),n.addChild(p),this.addChild(n),this.addChild(q),this.addChild(e),this.addChild(f),a.registerObservers(j),listenResize(this),this.startTutorial=function(a,b){k=!0,g||(g=new Tutorial),g.start(a,l,b),this.addChild(g)},this.nextHint=function(b){var c=g.nextHint();c||a.setTutorial(!1),1==c&&1==b&&a.clickOnShip(2)},this.updateIface=function(){if(a.getData().modal){if(h&&h.getText()==a.getData().modal)return;h&&h.parent&&(t_delInTicker(i),h.removeTweens(),h.parent.removeChild(h),h=null),h=new Modal(a.getData().modal),this.addChild(n),this.addChild(h),this.addChild(q),this.addChild(e),k&&this.addChild(g),h.y=0-l,h.slideFromTop(function(){i=t_delayOn(2,function(){h.slideToTop(function(){h.removeTweens(),h.parent.removeChild(h),h=null,a.modalClose()})})})}else h&&h.parent&&h.parent.removeChild(h),a.getData().only_ready?(c(),d()):b()},this.resize=function(b,c,d,i,j){var j=i/__HEIGHTBG*100,k=100*c/j;if(l=(k-HEIGHTGAME)/2,l>m&&(l=m),e.y=0-l,n.y=0-l,f.y=0+l,h&&(h.y=0-l),g){var o=a.getData();this.startTutorial(o.cur_step,!0)}},ResizeGame()}function Bomb(){this.initialize();this.mouseChildren=!1;var a=new createjs.Sprite(jsons.JSON1);a.gotoAndStop("bomb"),a.rotation=90,this.addChild(a),this.playSmoke=function(){var a=new createjs.Sprite(jsons.JSON3,"animsmoke");a.play(),a.addEventListener("animationend",function(a){a.target.stop(),a.target.parent&&a.target.parent.removeChild(a.target)}),a.rotation=-45,setCoor(a,-161,62),this.addChild(a)}}function Field(a,b,d){function e(){for(var a=d,b=0;a/2>b;b++)for(var c=0;a/2>c;c++){var e=new createjs.Sprite(jsons.JSON1);e.gotoAndStop("bg_tiles2x2"),e.x=0/__koefDisplay+80/__koefDisplay*b+80/__koefDisplay*c,e.y=441/__koefDisplay+-60/__koefDisplay*c+60/__koefDisplay*b,w.addChild(e)}}function f(a){var b=a;for(c=0;c<b.length;c++)if(b[c].getVisual()&&b[c].getVisual()[0]){for(var d=b[c].getVisual(),e=0;e<d.length;e++)b.push(d[e]);b.splice(c,1)}var f=new Array,h=0,i=function(){if(!(h>=100)){h++;for(var a=0;a<b.length;a++)for(var c=a+1;c<b.length;c++){var d=b[a].getTakes(),e=b[c].getTakes(),j=b[a].getName(),k=b[c].getName();g(d,e,j,k)&&(f.push([b[a],b[c]]),q(b,a,c),i())}}};return i(),b}function g(a,b,c,d){for(var e=0;e<a.length;e++)for(var f=0;f<b.length;f++){if(a[e].j==b[f].j&&a[e].i==b[f].i)return"empty"==d||"debris"==d||"chest"==d||"mine"==d?!0:!1;if(a[e].j==b[f].j&&a[e].i>b[f].i)return!0;if(a[e].i==b[f].i&&a[e].j<b[f].j)return!0;if(a[e].i!=b[f].i&&a[e].j!=b[f].j&&a[e].i>b[f].i&&a[e].j<b[f].j)return!0}}function h(){var a=new createjs.Sprite(jsons.JSON1);a.gotoAndStop("3ship"),a.scaleX=-1,16==d&&setCoor(a,1108,61),12==d&&setCoor(a,871,145),10==d&&setCoor(a,764,180);var b=new createjs.Sprite(jsons.JSON1);return b.gotoAndStop("3ship"),16==d&&setCoor(b,154,64),12==d&&setCoor(b,68,153),10==d&&setCoor(b,42,180),z.addChildAt(a,0),z.addChildAt(b,0),{user:a,bot:b}}function i(a,b,c){t_delInTicker(F);var e;16==d&&(e="user"==a?{x:1019,y:127}:{x:296,y:130}),12==d&&(e="user"==a?{x:769,y:214}:{x:214,y:222}),10==d&&(e="user"==a?{x:662,y:249}:{x:183,y:246}),E=new Array,D=0;for(var f=0;f<b.length;f++)1==b[f].length&&E.push({fun:l,par:[a,b[f][0].i,b[f][0].j,c,null,e.x,e.y,1]}),3==b[f].length&&E.push({fun:m,par:[a,b[f],c]}),4==b[f].length&&E.push({fun:n,par:[a,b[f],c,1]}),5==b[f].length&&E.push({fun:t,par:[a,b[f],c,1]});j()}function j(){t_delayOn(1,function(){return E[D]?(E[D].fun.apply(null,E[D].par),void D++):(A=!0,void b.changeCurrentPlayer())})}function k(a,c,d,e,f,g,h){f&&(F=t_delayOn(f,j));var i=!1,k=function(a,c,d){b.shot(a,c,d)};console.log(o(a,c,d,e)),o(a,c,d,e)?"mine"==o(a,c,d,e)?(p(c,d,"mine",null,g,k,[c,d,a,h]),i=!0):"ship"==o(a,c,d,e)&&(p(c,d,"ship",null,g,k,[c,d,a,h]),i=!0):(p(c,d,"empty",null,g,k,[c,d,a,h]),i=!0),i||k(c,d,a,h)}function l(b,c,d,e,f,g,h,i,j,l){var m=new Bomb;setCoor(m,g,h);var n=field_params.startX_bomb+field_params.dx*d+field_params.dx*c,o=field_params.startY_bomb+-field_params.dy*d+field_params.dy*c;a.removeEvents(),__tweener.tweenTo(m,{x:n,y:o,call:function(){a.addEvents(),k(b,c,d,e,i,null,l)}},v,null,!0,f,function(){v.addChild(m),m.playSmoke(),j?f&&p(null,null,"megashot",b):p(c,d,"shot",b),MusicCTRL.play("sound1")})}function m(a,b,c){var e;16==d&&(e="user"==a?[{x:1056,y:108},{x:1073,y:130},{x:1117,y:149}]:[{x:228,y:108},{x:205,y:131},{x:160,y:147}]),12==d&&(e="user"==a?[{x:728,y:218},{x:748,y:242},{x:790,y:260}]:[{x:227,y:223},{x:204,y:245},{x:162,y:266}]),10==d&&(e="user"==a?[{x:576,y:273},{x:597,y:299},{x:643,y:318}]:[{x:186,y:273},{x:165,y:296},{x:119,y:315}]);for(var f=0;f<b.length;f++){var g=0==f?!1:!0,h=0==f?1:0;l(a,b[f].i,b[f].j,c,g,e[f].x,e[f].y,h,!0,f+1)}}function n(b,c,e){var f=new createjs.Sprite(jsons.JSON1);f.gotoAndStop("plane");var g=new createjs.Sprite(jsons.JSON1);if(g.gotoAndStop("plane_bomb"),"user"==b)var h=field_params.startX_baloon+-10*field_params.dx+field_params.dx*c[0].i,i=field_params.startY_baloon+-10*-field_params.dy+field_params.dy*c[0].i,l=field_params.startX_baloon+field_params.dx*c[0].j+field_params.dx*c[0].i,m=field_params.startY_baloon+-field_params.dy*c[0].j+field_params.dy*c[0].i,n=field_params.startX_baloon+field_params.dx*d+field_params.dx*c[0].i,o=field_params.startY_baloon+-field_params.dy*d+field_params.dy*c[0].i,p=field_params.startX_bottle+field_params.dx*c[0].j+field_params.dx*c[0].i,q=field_params.startY_bottle+-field_params.dy*c[0].j+field_params.dy*c[0].i;else if("bot"==b){var h=field_params.startX_baloon+field_params.dx*c[0].j+field_params.dx*(d+10),i=field_params.startY_baloon+-field_params.dy*c[0].j+field_params.dy*(d+10),l=field_params.startX_baloon+field_params.dx*c[0].j+(field_params.dx*(c[0].i+2)+15/__koefDisplay),m=field_params.startY_baloon+-field_params.dy*c[0].j+(field_params.dy*(c[0].i+2)+15/__koefDisplay),n=field_params.startX_baloon+field_params.dx*c[0].j+0*field_params.dx,o=field_params.startY_baloon+-field_params.dy*c[0].j+0*field_params.dy,p=field_params.startX_bottle_r+field_params.dx*c[0].j+field_params.dx*c[0].i,q=field_params.startY_bottle_r+-field_params.dy*c[0].j+field_params.dy*c[0].i;f.scaleX=-1,g.scaleX=-1}f.x=n,f.y=o,v.addChild(f);var r=distXY(n,o,l,m)/300*__koefDisplay;a.removeEvents(),__tweener.tweenTo(f,{x:l,y:m,d:r,call:function(){g.x=p,g.y=q-158/__koefDisplay,v.addChild(g),v.addChild(f);var d=distXY(l,m,h,i)/300*__koefDisplay;tw_tweenTo(g,{x:p,y:q,d:.5,call:function(){v.removeChild(g);for(var a=0;a<c.length;a++){var d=0==a?1:!1;k(b,c[a].i,c[a].j,e,null,d)}}}),tw_tweenTo(f,{x:h,y:i,d:d,call:function(){v.removeChild(f),a.addEvents(),j()},everyTick:function(){var b=f.parent.localToGlobal(f.x,f.y);(b.x<0-f.getBounds().width||b.x>WIDTHGAME+f.getBounds().width||b.y<0||b.y>HEIGHTGAME)&&(tw_removeTween(f),v.removeChild(f),a.addEvents())}},v),t_delayOn(2,function(){j()})}},v)}function o(a,b,c,d){for(var e=0;e<d.length;e++)for(var f=d[e].getTakes(),g=0;g<f.length;g++)if(f[g].i==b&&f[g].j==c&&f.length>d[e].getHits().length)return d[e].getName()}function p(a,b,c,e,f,g,h){if("empty"==c){f||MusicCTRL.play("sound5");var i=new createjs.Sprite(jsons.JSON4);i.gotoAndPlay("miss_water_splash");var j=field_params.startX_anim_miss+field_params.dx*b+field_params.dx*a,k=field_params.startY_anim_miss+-field_params.dy*b+field_params.dy*a;setCoor(i,j,k)}else if("mine"==c){f||MusicCTRL.play("sound2");var i=new createjs.Sprite(jsons.JSON3);i.gotoAndPlay("water_exp-mine-treassure");var j=field_params.startX_anim_miss+field_params.dx*b+field_params.dx*a,k=field_params.startY_anim_miss+-field_params.dy*b+field_params.dy*a;setCoor(i,j,k)}else if("ship"==c){f||MusicCTRL.play("sound2");var i=new createjs.Sprite(jsons.JSON3);i.gotoAndPlay("exp_small-hit-ship");var j=field_params.startX_dim+field_params.dx*b+field_params.dx*a,k=field_params.startY_dim+-field_params.dy*b+field_params.dy*a;setCoor(i,j,k)}else if("shot"==c){var i=new createjs.Sprite(jsons.JSON3);i.gotoAndPlay("cannon"),"user"==e?(i.scaleX=-1,16==d&&setCoor(i,1078,22),12==d&&setCoor(i,837,137),10==d&&setCoor(i,743,137)):(16==d&&setCoor(i,193,31),12==d&&setCoor(i,98,118),10==d&&setCoor(i,68,141))}else if("megashot"==c){var i=new createjs.Sprite(jsons.JSON3);i.gotoAndPlay("cannon3"),"user"==e?(i.scaleX=-1,16==d&&setCoor(i,1097,14),12==d&&setCoor(i,843,115),10==d&&setCoor(i,734,148)):(16==d&&setCoor(i,184,34),12==d&&setCoor(i,102,136),10==d&&setCoor(i,73,145))}i.addEventListener("animationend",function(a){a.target.stop(),a.target.parent&&a.target.parent.removeChild(a.target),g&&h&&g.apply(null,h)}),v.addChild(i)}function q(a,b,c){var d=a[b];a[b]=a[c],a[c]=d}function r(a){var c;a.getCheck&&(c=!0);var d=a.getTakes(c);a.getVisual()[0]||(a.getVisual().setParent(v,b),a.getVisual().setToCell(d[0].i,d[0].j),z.addChild(a.getVisual()))}function s(a){if(G){G=!1;for(var c,e=b.getData(),f=0;f<e.game_data.selected_objects.length;f++)"periskop"==e.game_data.selected_objects[f].getName()&&(c=e.game_data.selected_objects[f]);c.clearVisible(),c.setVisible("submarine_area1"),c.setMouseEnabled(!1),c.dontMouseTouch();var g=c.getTakes()[0],h=field_params.startX_subm+field_params.dx*g.j+field_params.dx*g.i,i=field_params.startY_subm+-field_params.dy*g.j+field_params.dy*g.i,j=field_params.startX_subm+field_params.dx*d+field_params.dx*g.i,k=field_params.startY_subm+-field_params.dy*d+field_params.dy*g.i,l=new createjs.Sprite(jsons.JSON2);l.gotoAndStop("submarine"),v.addChildAt(l,0),l.x=j,l.y=k;var m=distXY(j,k,h,i)/300*__koefDisplay;__tweener.tweenTo(l,{x:h,y:i,d:m,call:function(){c.clearVisible(),c.setVisible("submarine_area2"),a(),tw_tweenTo(l,{x:l.x,y:l.y,alpha:.01,call:function(){v.removeChild(l)}}),G=!0}},v)}}function t(b,c,e){var f=new createjs.Sprite(jsons.JSON4);if(f.gotoAndPlay("torpedo"),"user"==b)var g=field_params.startX_torpedo+field_params.dx*c[0].j+field_params.dx*c[0].i,h=field_params.startY_torpedo+-field_params.dy*c[0].j+field_params.dy*c[0].i,i=field_params.startX_torpedo+field_params.dx*d+field_params.dx*c[0].i,j=field_params.startY_torpedo+-field_params.dy*d+field_params.dy*c[0].i;else if("bot"==b){var g=(field_params.startX_torpedo+field_params.dx*c[0].j+field_params.dx*(d+10),field_params.startY_torpedo+-field_params.dy*c[0].j+field_params.dy*(d+10),88/__koefDisplay+field_params.dx*c[0].j+(field_params.dx*c[0].i+15/__koefDisplay)),h=386/__koefDisplay+-field_params.dy*c[0].j+(field_params.dy*c[0].i+15/__koefDisplay),i=88/__koefDisplay+field_params.dx*c[0].j+-1*field_params.dx,j=386/__koefDisplay+-field_params.dy*c[0].j+-1*field_params.dy;f.scaleX=-1}f.x=i,f.y=j,v.addChildAt(f,0);var l=distXY(i,j,g,h)/300*__koefDisplay;a.removeEvents(),__tweener.tweenTo(f,{x:g,y:h,d:l,call:function(){a.addEvents(),v.removeChild(f);for(var d=0;d<c.length;d++){var g=0==d?1:!1;k(b,c[d].i,c[d].j,e,g,g)}}},v)}function u(){var a=b.getData(),c=new createjs.Sprite(jsons.JSON1);c.gotoAndPlay("coin");var d=field_params.startX_money+field_params.dx*a.game_data.flying_money.j+field_params.dx*a.game_data.flying_money.i,e=field_params.startY_money+-field_params.dy*a.game_data.flying_money.j+field_params.dy*a.game_data.flying_money.i,f=v.globalToLocal(2/__koefDisplay,224/__koefDisplay),g=f.x,h=f.y;c.x=d,c.y=e,v.addChild(c),a.game_data.flying_money=!1,t_delayOn(.3,function(){tw_tweenTo(c,{x:g,y:h,d:.5,call:function(a){a.parent&&a.parent.removeChild(a)},pars:[c]})})}this.initialize();var v=this,w=new createjs.Container;e();var x=new createjs.Sprite(jsons.JSON1);x.gotoAndStop("bg_octopus"),setCoor(x,28,753);var y=new createjs.Sprite(jsons.JSON1);y.gotoAndStop("bg_symbol"),16==d&&setCoor(y,833,-152),12==d&&setCoor(y,625,-49),10==d&&setCoor(y,507,-19),this.addChild(w);var z=new createjs.Container;this.addChild(z),b.registerObservers(this);var A=!0,B=!0,C=!0;this.updateField=function(c){var d=b.getData();d.scale_field!=this.scaleX&&(this.scaleX=this.scaleY=d.scale_field,this.x=WIDTHGAME/2-w.getBounds().width*this.scaleX/2,this.y=HEIGHTGAME/2-this.getBounds().height*this.scaleX/2);var e=(new Array,new Array);z.removeAllChildren();var g=new Array;g=g.concat(d.game_data.used_move_user),g=g.concat(d.game_data.used_move_bot);for(var j=new Array,k=0;k<g.length;k++)"chest"==g[k].getName();if(1==c){e=e.concat(d.game_data.ships_user),e=e.concat(d.game_data.mines_user),e=e.concat(d.game_data.chest_user),e=e.concat(d.game_data.rocks),f(e);for(var k=0;k<e.length;k++)r(e[k]),e[k].setMouseEnabled(!0);C&&(C=!1,tw_tweenTo(this,{x:WIDTHGAME/2-w.getBounds().width*this.scaleX/2,y:.1,d:.5}))}if(2==c){e=e.concat(d.game_data.used_move_user),e=e.concat(d.game_data.rocks),e=e.concat(d.game_data.periskop_view_user),e=e.concat(d.game_data.used_objects),e=e.concat(j),d.game_data.selected_objects&&(e=e.concat(d.game_data.selected_objects)),f(e),d.game_data.periscopes&&(e=d.game_data.periscopes.concat(e));for(var k=0;k<e.length;k++)r(e[k]),e[k].setMouseEnabled(!0);d.game_data.periskop2&&s(d.game_data.periskop_active),B&&(B=!1,tw_tweenTo(this,{x:WIDTHGAME/2-w.getBounds().width*this.scaleX/2,y:.1,d:.5})),A=!0}if(3==c){e=e.concat(d.game_data.rocks),e=e.concat(j),"user"==d.game_data.current_stage?e=e.concat(d.game_data.used_move_user):(e=e.concat(d.game_data.used_move_bot),e=e.concat(d.game_data.ships_user),e=e.concat(d.game_data.mines_user),e=e.concat(d.game_data.chest_user)),f(e);for(var k=0;k<e.length;k++)r(e[k]),e[k].setMouseEnabled(!1);d.game_data.flying_money&&u();var l=h();if("user"==d.game_data.current_stage?(l.user.alpha=1,l.bot.alpha=.5):"bot"==d.game_data.current_stage&&(l.bot.alpha=1,l.user.alpha=.5),d.modal)return void t_setPause(F);if(t_delInPause(F),!A)return;var m,n,o;"user"==d.game_data.current_stage?(m=d.game_data.ships_bot,m=m.concat(d.game_data.mines_bot),m=m.concat(d.game_data.chest_bot),n=d.game_data.user_targets,o=l.user):"bot"==d.game_data.current_stage&&(m=d.game_data.ships_user,m=m.concat(d.game_data.mines_user),m=m.concat(d.game_data.chest_user),n=d.game_data.bot_targets,o=l.bot),o&&a.removeEvents(),__tweener.tweenTo(o,null,v,function(){a.addEvents(),i(d.game_data.current_stage,n,m)}),A=!1,B=!0,d.game_data.current_stage||b.nextStep()}},this.removeDragAndDrop=function(){a.removeEvents()},this.addDragAndDrop=function(){a.addEvents()};var D,E,F,G=!0}function TweenerObjects(){function a(a,b){return a>c&&d>a&&b>e&&f>b?!0:void 0}function b(b,g){var h,i;return a(b,g)?{x:0,y:0}:(h=b>c&&d>b?0:distXY(b,g,c,g)>distXY(b,g,d,g)?d-b:c-b,i=g>e&&f>g?0:distXY(b,g,b,e)>distXY(b,g,b,f)?f-g:e-g,{x:h,y:i})}var c=270/__koefDisplay,d=370/__koefDisplay,e=430/__koefDisplay,f=530/__koefDisplay;this.tweenTo=function(c,d,e,f,g,h,i){var j=function(){var d=e.localToGlobal(c.x*e.scaleX,c.y*e.scaleX);if(!a(d.x,d.y)){var f=b(d.x,d.y);e.x+=f.x,e.y+=f.y}},k=function(){if(!d)return void(f&&f());if(h||(d.everyTick=j),g){var a=new ClassBezier;a.setObject(c),a.setSpeed(.04),a.setEveryTick(d.everyTick);var b=c.x+(d.x-c.x)/2,e=c.y+(d.y-c.y)/2-300/__koefDisplay;a.set(c.x,c.y,b,e,d.x,d.y);var i=!1,k=function(){a.Iter(function(){i=!0,c.parent&&c.parent.removeChild(c),d.call&&d.call()}),i||t_delayOn(.001,k)};k()}else tw_tweenTo(c,d)};if(c){var l=e.localToGlobal(c.x,c.y),m=b(l.x,l.y),n=m.x,o=m.y;if(h)i&&i(),k();else{var p=e.scaleX;tw_tweenTo(e,{x:e.x+n,y:e.y+o,d:.5,call:function(){i&&i(),k()},everyTick:function(){e.scaleX!=p&&(tw_removeTween(e),p=e.scaleX,i&&i(),k())}})}}}}function BottomInterface(a){function b(b){d.removeAllChildren();var k=a.getData();1==b&&(d.addChild(e),d.addChild(f),d.addChild(g),d.addChild(h),d.addChild(i),d.addChild(j),f.mouseEnabled=!0,g.mouseEnabled=!0,h.mouseEnabled=!0,i.mouseEnabled=!0,k.game_data.num_deck1>0?f.setText(k.game_data.num_deck1):(f.mouseEnabled=!1,f.changeFrame("off",!0),f.setText(-1)),k.game_data.num_deck2>0?g.setText(k.game_data.num_deck2):(g.mouseEnabled=!1,g.changeFrame("off",!0),g.setText(-1)),k.game_data.num_deck3>0?h.setText(k.game_data.num_deck3):(h.mouseEnabled=!1,h.changeFrame("off",!0),h.setText(-1)),k.game_data.num_mine>0?j.setText(k.game_data.num_mine):(i.mouseEnabled=!1,i.changeFrame("off",!0),j.changeFrame("off",!0),j.setText(-1))),2==b&&(d.addChild(e),d.addChild(l),d.addChild(m),d.addChild(n),d.addChild(o),d.addChild(p),l.mouseEnabled=!0,l.visible=!1,m.mouseEnabled=!0,n.mouseEnabled=!0,o.mouseEnabled=!0,p.mouseEnabled=!0,k.game_data.dinamite_num_user>0?(m.setText(k.game_data.dinamite_num_user),m.changeFrame("on",!0)):(m.mouseEnabled=!1,m.changeFrame("off",!0),m.setText(-1)),k.game_data.multibomb_num_user>0?(n.setText(k.game_data.multibomb_num_user),n.changeFrame("on",!0)):(n.mouseEnabled=!1,n.changeFrame("off",!0),n.setText(-1)),k.game_data.periskope_num_user>0?(o.setText(k.game_data.periskope_num_user),o.changeFrame("on",!0)):(o.mouseEnabled=!1,o.changeFrame("off",!0),o.setText(-1)),k.game_data.torpedo_num_user>0?(p.setText(k.game_data.torpedo_num_user),p.changeFrame("on",!0)):(p.mouseEnabled=!1,p.changeFrame("off",!0),p.setText(-1)),m.setIcon(c(k.game_data.selected_objects,"dinamite")?2:1),n.setIcon(c(k.game_data.selected_objects,"bomb")?2:1),o.setIcon(c(k.game_data.selected_objects,"periskop")?2:1),p.setIcon(c(k.game_data.selected_objects,"torpedo")?2:1),l.setIcon(c(k.game_data.selected_objects,"anim-target")?2:1))}function c(a,b){for(var c=0;c<a.length;c++)if(a[c].getName()==b)return!0}this.initialize();var d=this,e=new createjs.Sprite(jsons.JSON1);e.gotoAndStop("area_bonus"),setCoor(e,9,596);var f=new Button({pod:"btn_2",i:"icon_ship1",iconX:17,iconY:12,iconScale:1,txt:"0",font:"numbers_red_small_",txtX:100,txtY:105});setCoor(f,38,568),f.addEventListener("click",function(){a.clickOnShip(1)});var g=new Button({pod:"btn_2",i:"icon_ship2",iconX:15,iconY:15,iconScale:1,txt:"0",font:"numbers_red_small_",txtX:100,txtY:105});setCoor(g,181,568),g.addEventListener("click",function(){a.clickOnShip(2)});var h=new Button({pod:"btn_2",i:"icon_ship3",iconX:17,iconY:15,iconScale:1,txt:"0",font:"numbers_red_small_",txtX:100,txtY:105});setCoor(h,327,568),h.addEventListener("click",function(){a.clickOnShip(3)});var i=new Button({pod:"btn_2"}),j=new Button({i:"icon_mine",iconX:16,iconY:14,iconScale:1,txt:"0",font:"numbers_red_small_",txtX:100,txtY:105},1);setCoor(j,467,568),setCoor(i,467,568),i.addEventListener("click",function(){a.clickOnMine()});var k=1,l=new Button({pod:"btn_2",i:"icon_attack1",i2:"icon_attack2",iconX:21,iconY:19,iconScale:1,txt:"0",font:"numbers_red_small_",txtX:100,txtY:105});setCoor(l,5*k,568),l.addEventListener("click",function(){a.clickOnTarget()}),l.setText(-1);var m=new Button({pod:"btn_2",i:"3-2",i2:"3-1",iconX:25,iconY:36,iconScale:1,txt:"0",font:"numbers_red_small_",txtX:100,txtY:105});setCoor(m,181,568),m.addEventListener("click",function(){a.clickOnBonus("dinamite")});var n=new Button({pod:"btn_2",i:"1-2",i2:"1-1",iconX:31,iconY:32,iconScale:1,txt:"0",font:"numbers_red_small_",txtX:100,txtY:105});setCoor(n,327,568),n.addEventListener("click",function(){a.clickOnBonus("bomb")});var o=new Button({pod:"btn_2",i:"2-2",i2:"2-1",iconX:31,iconY:39,iconScale:1,txt:"0",font:"numbers_red_small_",txtX:100,txtY:105});setCoor(o,467,568),o.addEventListener("click",function(){a.clickOnBonus("periskop")});var p=new Button({pod:"btn_2",i:"4-2",i2:"4-1",iconX:28,iconY:34,iconScale:1,txt:"0",font:"numbers_red_small_",txtX:100,txtY:105});setCoor(p,38,568),p.addEventListener("click",function(){a.clickOnBonus("torpedo")}),l.scaleX=l.scaleY=k,m.scaleX=m.scaleY=k,n.scaleX=n.scaleY=k,o.scaleX=o.scaleY=k,p.scaleX=p.scaleY=k,a.registerObservers(d),this.updateBottomIface=function(){var c=a.getData();b(c.cur_step)}}function Hint(){this.initialize()}function Modal(a){this.initialize();var b=new createjs.Container,c=new createjs.Shape;c.graphics.beginFill("000").drawRect(0,0,WIDTHGAME,HEIGHTGAME);var d=new createjs.Sprite(jsons.JSON2);d.gotoAndStop("window"),d.scaleX=d.scaleY=.8,setCoor(d,126,-254),d.x=WIDTHGAME/2-d.getBounds().width*d.scaleX/2;var e=new createjs.Sprite(jsons.JSON2);e.gotoAndStop(a),setCoor(e,239,130),e.x=WIDTHGAME/2-e.getBounds().width/2,e.y=170/__koefDisplay-e.getBounds().height/2,this.addChild(b),b.addChild(d),b.addChild(e),this.slideFromTop=function(a){b.y=-180/__koefDisplay,tw_tweenTo(b,{x:b.x,y:.1,d:.5,call:a})},this.slideToTop=function(a){var c=-180/__koefDisplay;tw_tweenTo(b,{x:b.x,y:c,d:.5,call:a})},this.slideOnBottom=function(a){tw_tweenTo(b,{x:b.x,y:HEIGHTGAME,d:.5,call:a})},this.removeTweens=function(){tw_removeTween(b)},this.getChanges=function(){return b},this.getText=function(){return a}}function Timer(){this.initialize();this.mouseChildren=!1;var a=new Text(jsons.JSON2,"numbers_red_",null,23),b=new Text(jsons.JSON2,"numbers_red_",null,23);setCoor(b,69);var c=new createjs.Sprite(jsons.JSON2);c.gotoAndStop("numbers_red_two-spot"),setCoor(c,47),this.addChild(a),this.addChild(b),this.addChild(c),this.setTime=function(c){var d=null,e=null;d=div(c,60),e=c%60,10>d&&(d="0"+d),10>e&&(e="0"+e),a.setText(d),b.setText(e)}}function TopInterface(a,b,c){function d(d){h.removeAllChildren();var g=a.getData();(1==d||2==d||3==d)&&(h.addChild(l),h.addChild(n),h.addChild(p),h.addChild(q),h.addChild(r),h.addChild(u),h.addChild(m),h.addChild(s),h.addChild(t),m.visible=!1,l.visible=!1,n.visible=!0,p.visible=!0,q.visible=!0,r.visible=!0,s.visible=!0,c.visible=!0,b.visible=!0,"transp"==g.cur_ship&&q.gotoAndStop("btn_transperent_on"),"real"==g.cur_ship&&q.gotoAndStop("btn_transperent_off"),g.ready?(s.mouseEnabled=!0,r.gotoAndStop("btn_ok_on"),j||f()):(s.mouseEnabled=!1,r.gotoAndStop("btn_ok_off")),c.setText(g.user_money),b.x=-133/__koefDisplay+20*g.user_money.toString().length/__koefDisplay,m.setText(g.life_user),t.setIcon(g.loupe_active?2:1)),1==d&&(c.visible=!1,b.visible=!1),2==d&&(n.visible=!1,l.visible=!0,m.visible=!0,g.ready?(s.mouseEnabled=!0,r.gotoAndStop("btn_ok_on"),j||f()):(s.mouseEnabled=!1,r.gotoAndStop("btn_ok_off"))),3==d&&(m.visible=!0,l.visible=!0,n.visible=!1),e(g.time)}function e(a){-1==a&&(a=0),i=a,u.setTime(a)}function f(){t_delInTicker(g),j=!0,r.gotoAndStop("btn_ok_on");var a=0,b=function(){return a>6||!s.mouseEnabled?(j=!1,void(r.visible=!0)):(a++,r.visible=1==r.visible?!1:!0,void(g=t_delayOn(.2,b)))};b()}this.initialize();var g,h=this,i=0,j=!1,k=new createjs.Sprite(jsons.JSON1);k.gotoAndStop("interface");var l=new createjs.Sprite(jsons.JSON1);l.gotoAndStop("icon_life"),setCoor(l,36,3);var m=new Text(jsons.JSON2,"numbers_green_small_","Center",15);setCoor(m,120,57);var n=new createjs.Sprite(jsons.JSON1);n.gotoAndStop("btn_random"),setCoor(n,38,-1),n.addEventListener("click",function(){a.randomClick()});var o=new createjs.Shape;o.graphics.beginFill("#000000").drawRect(0,0,100/__koefDisplay,100/__koefDisplay);var p=new createjs.Sprite(jsons.JSON1);p.gotoAndStop("btn_pause"),setCoor(p,136,4),p.hitArea=o,p.addEventListener("click",function(){a.pauseClick()});var q=new createjs.Sprite(jsons.JSON1);setCoor(q,426,-3),q.addEventListener("click",function(){a.shipClick()});var r=new createjs.Sprite(jsons.JSON1);r.gotoAndStop("btn_ok_on"),setCoor(r,516,4);var s=new createjs.Shape;s.graphics.beginFill("#000000").drawRect(0,0,66/__koefDisplay,56/__koefDisplay),setCoor(s,530,27),s.alpha=.01,s.addEventListener("click",function(){a.readyClick()});var t=new Button({pod:"btn_loop",i:"icon_loop_minus",i2:"icon_loop_plus",iconX:-2,iconY:1});
setCoor(t,536,84),t.addEventListener("click",function(){a.clickOnLoupe()});var u=new Timer;setCoor(u,261,5),q.gotoAndStop("btn_transperent_off"),h.addChild(l),h.addChild(n),h.addChild(p),h.addChild(q),h.addChild(r),h.addChild(u),h.addChild(m),h.addChild(s),a.registerObservers(h),e(0),this.onlyreadyEnable=function(){for(var a=0;a<this.getNumChildren();a++)this.getChildAt(a).mouseEnabled=!1;s.mouseEnabled=!0,p.mouseEnabled=!0},this.enableAll=function(){for(var a=0;a<this.getNumChildren();a++)this.getChildAt(a).mouseEnabled=!0},this.updateTopIface=function(){var b=a.getData();d(b.cur_step)},this.setLife=function(a){var b=a?a:0;m.setText(b)},this.setVisibleRandom=function(a){n.visible=a},this.setStep=function(a){d(a)}}function Tutorial(){function a(){f={1:[[["1_1",36,100-e],["1_1(2)",36,428+e]],[["2_1",264,184]],[["2_2",277,166]],[["3",364,100-e]]],2:[[["4_1",240,259]],[["4_2",380,444+e]],[["4_3",14,202-e]],[["4_4",189,108-e]]]}}this.initialize();var b,c,d=this,e=0,f={1:[[["1_1",36,100-e],["1_1(2)",36,428+e]],[["2_1",264,184]],[["2_2",277,166]],[["3",364,100-e]]],2:[[["4_1",240,259]],[["4_2",380,444]],[["4_3",14,202]],[["4_4",189,108]]]};this.start=function(g,h,i){d.removeAllChildren(),e=h*__koefDisplay,a();var j=f[g];if(c=new Array,i?b--:b=-1,j){for(var k=0;k<j.length;k++){var l=new createjs.Container;if(!j[k])return;for(var m=0;m<j[k].length;m++){var n=j[k][m][0],o={x:j[k][m][1],y:j[k][m][2]},p=new createjs.Sprite(jsons.JSON1);p.gotoAndStop("hints"+n),setCoor(p,o.x,o.y),l.addChild(p)}l.visible=!1,d.addChild(l),c.push(l)}this.nextHint()}},this.nextHint=function(){b++;for(var a=0;a<c.length;a++)c[a].visible=!1;return b>c.length-1?!1:(c[b].visible=!0,b)}}function ItemShop(a){this.initialize();this.mouseChildren=!1;var b,c=[["life",171,183,47,63],["bombs",171,183,47,63],["submarine",154,153,44,49],["torpedo",154,153,44,49],["air_strike",154,153,44,49]],d=new createjs.Sprite(jsons.JSON2);d.gotoAndStop("shop_"+a);for(var e=new Text(jsons.JSON2,"numbers_red_","Center",20),f=new Text(jsons.JSON2,"numbers_green_small_","Center",20),g=0;g<c.length;g++)c[g][0]==a&&(setCoor(e,c[g][1],c[g][2]),setCoor(f,c[g][3],c[g][4]));this.addChild(d),this.addChild(e),this.addChild(f),this.setNum=function(a){e.setText(a)},this.setPrice=function(a){b=a,f.setText(b)},this.getPrice=function(){return b},this.getName=function(){return a}}function Mine(a,b,c){function d(){i.regX=19/__koefDisplay,i.regY=46/__koefDisplay}this.initialize();var e,f,g,h="goriz",i=this,j=c?"_"+c:"",k=field_params.startX_mine,l=field_params.startY_mine,m=new Array,n=0,o=new createjs.Sprite(jsons.JSON1),p=new Array;b&&o.gotoAndStop(b+j),this.mouseChildren=!1,b&&this.addChild(o),d(),this.setGraphics=function(a,b,c,d,e){var f=new createjs.Sprite(a);c?f.gotoAndPlay(b):f.gotoAndStop(b),"number"==typeof d&&"number"==typeof e&&setCoor(f,d,e),this.addChild(f)},this.clearGraphics=function(){this.removeAllChildren()},this.setStartCoor=function(a,b){k=a,l=b},this.changeDir=function(){h="goriz"==h?"vert":"goriz"},this.getDirect=function(){return h},this.setAlpha=function(){},this.setToCell=function(a,b){setCoor(this,k*__koefDisplay+field_params.dx*__koefDisplay*b+field_params.dx*__koefDisplay*a,l*__koefDisplay+-field_params.dy*__koefDisplay*b+field_params.dy*__koefDisplay*a)},this.setParent=function(a,b){e=a,f=b},this.moveUp=function(){if(n>1){for(var b={i:0,j:0},c=distXY(i.x,i.y,k+0*field_params.dx+0*field_params.dx,l+0*-field_params.dy+0*field_params.dy),d=0;d<f.getDimension();d++)for(var g=0;g<f.getDimension();g++){var h=distXY(i.x,i.y,k+field_params.dx*g+field_params.dx*d,l+-field_params.dy*g+field_params.dy*d);c>h&&(c=h,b={i:d,j:g})}f.setToCell(a,b.i,b.j)}else f.rotateShip(a,"goriz");e.addDragAndDrop()},this.moveDown=function(){e.removeDragAndDrop(),i.parent.addChild(i),t_delInTicker(g),n=0;var a=function(){n++,g=t_delayOn(.1,a)};a()},this.movePress=function(){i.parent.addChild(i)},dragAndDrop(i,i.moveUp,i.moveDown,i.movePress),this.getCheck=function(){return!0},this.setCell=function(a,b){p.push({i:a,j:b})},this.setListener=function(a,b,c){i.removeAllEventListeners(),a&&m.push(a),b&&m.push(b),c&&m.push(c),dragAndDrop(i,i.moveUp,i.moveDown,i.movePress,m)},this.getTakes=function(b){for(var c=a.getTakes()[0],d=new Array,e=0;e<p.length;e++)d.push({i:p[e].i+c.i,j:p[e].j+c.j});return b?a.getTakes():d},this.getName=function(){return a.getName()},this.getVisual=function(){return this},this.setMouseEnabled=function(a){"part_ship"==b||"rock"==b||"debris"==b||"empty"==b||"chest"==b||"mine"==b&&shots||(this.mouseEnabled=a)}}function Ship(a,b,c){function d(){q||(q=!0,dragAndDrop(k,function(a){if(m>1){for(var b={i:0,j:0},d=distXY(a.x,a.y,field_params.startX_1+0*field_params.dx+0*field_params.dx,field_params.startY_1+0*-field_params.dy+0*field_params.dy),f=0;f<i.getDimension();f++)for(var g=0;g<i.getDimension();g++){var j=distXY(a.x,a.y,field_params.startX_1+field_params.dx*g+field_params.dx*f,field_params.startY_1+-field_params.dy*g+field_params.dy*f);d>j&&(d=j,b={i:f,j:g})}i.setToCell(c,b.i,b.j)}else{var k=e();i.rotateShip(c,k)}h.addDragAndDrop()},function(){h.removeDragAndDrop(),t_delInTicker(g),m=0;var a=function(){m++,g=t_delayOn(.1,a)};a()},null,null,j),this.addEventListener("pressup",e))}function e(){return"goriz"==l?(l="vert",p.scaleX=-1,1==a&&setCoor(p,73,2),2==a&&setCoor(p,96,32),3==a&&setCoor(p,152,61)):(l="goriz",p.scaleX=1,setCoor(p,0,0)),l}function f(){1==a&&(k.regX=14/__koefDisplay,k.regY=89/__koefDisplay),2==a&&(k.regX=34/__koefDisplay,k.regY=174/__koefDisplay),3==a&&(k.regX=32/__koefDisplay,k.regY=190/__koefDisplay)}this.initialize();var g,h,i,j,k=this,l=b,m=0,n=!1,o=a+"ship",p=new createjs.Sprite(jsons.JSON1);p.gotoAndStop(o),this.mouseChildren=!1,this.addChild(p),f(),this.getDirect=function(){return l},this.setToCell=function(b,c){1==a&&setCoor(this,field_params.startX_1*__koefDisplay+field_params.dx*__koefDisplay*c+field_params.dx*__koefDisplay*b,field_params.startY_1*__koefDisplay+-field_params.dy*__koefDisplay*c+field_params.dy*__koefDisplay*b),2==a&&setCoor(this,field_params.startX_2*__koefDisplay+field_params.dx*__koefDisplay*c+field_params.dx*__koefDisplay*b,field_params.startY_2*__koefDisplay+-field_params.dy*__koefDisplay*c+field_params.dy*__koefDisplay*b),3==a&&setCoor(this,field_params.startX_3*__koefDisplay+field_params.dx*__koefDisplay*c+field_params.dx*__koefDisplay*b,field_params.startY_3*__koefDisplay+-field_params.dy*__koefDisplay*c+field_params.dy*__koefDisplay*b)},this.setParent=function(a,b){h=a,i=b,j=i.getData().scale_field,d()},this.changeDir=function(){e()},this.setAlpha=function(a){var b=a?o:o+"_alpha";n=a?!1:!0,p.gotoAndStop(b)},this.setGraphics=function(a){this.removeAllChildren(),o=a,l="goriz"==l?"vert":"goriz",e(),p.gotoAndStop(n?o+"_alpha":o),this.addChild(p)};var q=!1;e()}function About(){this.initialize();var a=new createjs.Sprite(jsons.JSON2);a.gotoAndStop("window"),a.x=WIDTHGAME/2-a.getBounds().width/2,a.y=HEIGHTGAME/2-a.getBounds().height/2;var b=new createjs.Sprite(jsons.JSON1);b.gotoAndStop("about"),setCoor(b,133,150),b.x=WIDTHGAME/2-b.getBounds().width/2,b.addEventListener("click",function(){window.open(__config.url,"_blank")});var c=new createjs.Sprite(jsons.JSON2);c.gotoAndStop("text_red_about"),setCoor(c,257,6);var d=new Arrow("left");setCoor(d,54,19),d.addEventListener("click",function(){v_choiseLocation("setting")});var e=new createjs.Sprite(jsons.JSON2);e.gotoAndStop("window_crown"),setCoor(e,19,600);var f=new FloatFrame;f.addToTopPlatform(b,0),f.addToTopPlatform(a,0),f.addToTopPlatform(d),f.addToTopPlatform(e),f.addToTopPlatform(c),this.addChild(f)}function BonusWnd(){function a(){v_choiseLocation("game",{dont_update:!0}),t_delAllInPause()}this.initialize();this.mouseChildren=!1;var b,c=new createjs.Sprite(jsons.JSON1),d=new createjs.Sprite(jsons.JSON2);setCoor(d,164,334);var e=new createjs.Sprite(jsons.JSON2);e.gotoAndStop("window_rewards"),setCoor(e,2,-80);var f=new Button({pod:"btn_loop",i:"btn_arrow",iconX:84,iconY:20,iconScaleX:-1});setCoor(f,522,604);var g=new createjs.Shape;g.graphics.beginFill("#000000").drawRect(0,0,WIDTHGAME,HEIGHTGAME),this.hitArea=g,this.addEventListener("click",function(){a(),t_delInTicker(b)}),this.registerObservers=function(){};var h=new TopInterface(this);h.mouseChildren=!1,h.setVisibleRandom(!1);var i=new FloatFrame;i.addToTopPlatform(h),this.addChild(i),this.addChild(e),this.addChild(d),this.addChild(f),this.addChild(c),this.update=function(e){(e||e.name)&&(e.life&&h.setLife(e.life),i.addToTopPlatform(h),console.log(e.name),c.gotoAndStop(e.name),setCoor(c,j[e.name][0],j[e.name][1]),t_allInPause(),d.gotoAndStop("reward_"+e.name),b=t_delayOn(10,a))};var j={bombs:[160,245],air_strike:[165,244],submarine:[163,243],life:[162,237],torpedo:[161,245]}}function ChoiseLvl(){this.initialize();var a=new createjs.Sprite(jsons.JSON2);a.gotoAndStop("window"),a.x=WIDTHGAME/2-a.getBounds().width/2,a.y=HEIGHTGAME/2-a.getBounds().height/2;var b=new createjs.Sprite(jsons.JSON2);b.gotoAndStop("text_red_map"),setCoor(b,140,6),b.x=WIDTHGAME/2-b.getBounds().width/2;var c=new createjs.Sprite(jsons.JSON2);c.gotoAndStop("text_red_choose_map"),setCoor(c,140,645),c.x=WIDTHGAME/2-c.getBounds().width/2;var d=new createjs.Sprite(jsons.JSON1);d.gotoAndStop("map_small"),setCoor(d,97,135),d.addEventListener("click",function(){st_getNumPlay()<1?v_choiseLocation("instructions",{game:!0,size_field:10}):v_choiseLocation("game",{size_field:10})});var e=new createjs.Sprite(jsons.JSON1);e.gotoAndStop("map_medium"),setCoor(e,95,303),e.addEventListener("click",function(){st_getNumPlay()<1?v_choiseLocation("instructions",{game:!0,size_field:12}):v_choiseLocation("game",{size_field:12})});var f=new createjs.Sprite(jsons.JSON1);f.gotoAndStop("map_large"),setCoor(f,97,475),f.addEventListener("click",function(){st_getNumPlay()<1?v_choiseLocation("instructions",{game:!0,size_field:16}):v_choiseLocation("game",{size_field:16})});var g=new Arrow("left");setCoor(g,54,19),g.addEventListener("click",function(){v_choiseLocation("menu")});var h=new FloatFrame;h.addToTopPlatform(a,0),h.addToTopPlatform(b),h.addToTopPlatform(c),h.addToTopPlatform(d),h.addToTopPlatform(e),h.addToTopPlatform(f),h.addToTopPlatform(g),this.addChild(h)}function Game(){this.initialize();var a,b,c,d,e,f,g=new createjs.Shape;g.graphics.beginFill("#000000").drawRect(0,0,WIDTHGAME,HEIGHTGAME),this.update=function(g){if(g&&g.dont_update)return void(g.unPause&&b.pauseClick());st_setNumPlay(1),this.removeAllChildren(),t_delAllInPause(),t_delAllInTicker(),tw_removeAllTweens(),e=new LogicGame(g.size_field),a=new ViewModelGame(e),b=new ViewModelInterface(e);var h=1==st_getNumPlay()?!0:!1;e.init(h),c=a.getVisual(),f=b.getTutorial(),d=b.getVisual(),this.addChild(c),this.addChild(d),this.addChild(f)}}function GameOver(){this.initialize();var a=new createjs.Container,b=new createjs.Sprite(jsons.JSON2);b.gotoAndStop("window_crown"),setCoor(b,19,600);var c=new createjs.Sprite(jsons.JSON2);c.gotoAndStop("window"),c.x=WIDTHGAME/2-c.getBounds().width/2,c.y=HEIGHTGAME/2-c.getBounds().height/2;var d=new createjs.Sprite(jsons.JSON2);setCoor(d,212,5);var e=new createjs.Sprite(jsons.JSON2);e.gotoAndStop("text_hit_rate"),setCoor(e,127,464);var f=new Arrow("left");setCoor(f,54,19);var g=new Button({i:"btn_reset"});setCoor(g,522,19);var h=new createjs.Sprite(jsons.JSON2);h.gotoAndStop("text_cash"),setCoor(h,209,348);var i=new createjs.Sprite(jsons.JSON1);i.gotoAndStop("icon_money"),setCoor(i,114,320);var j=new createjs.Sprite(jsons.JSON2),k=new createjs.Sprite(jsons.JSON2);k.gotoAndStop("text_opponents"),setCoor(j,183,160),setCoor(k,174,189),f.addEventListener("click",function(){v_choiseLocation("menu")}),g.addEventListener("click",function(){v_choiseLocation("choise")});var l=new createjs.Container,m=new FloatFrame;m.addToTopPlatform(a,0),m.addToTopPlatform(d),m.addToTopPlatform(b),m.addToTopPlatform(f),m.addToTopPlatform(g),m.addToTopPlatform(h),m.addToTopPlatform(i),a.addChild(c),a.addChild(e),a.addChild(l),a.addChild(j),this.addChild(m),this.update=function(a){FB_GO();var b="";b=a&&"text_red_victory"==a.title?"_opponents":"",j.gotoAndStop("sunk"==a.reason?"text"+b+"_fleet_sunk":"text"+b+"_lives_lost"),d.gotoAndStop(a.title),d.x=WIDTHGAME/2-d.getBounds().width/2,l.removeAllChildren();var c=new Text(jsons.JSON2,"numbers_green_",null,33);c.setText(a.hit_rate_user+"%"),setCoor(c,355,469);var e=new Text(jsons.JSON2,"numbers_green_",null,33);e.setText(a.num_money),setCoor(e,341,348);var f=new Text(jsons.JSON2,"numbers_green_",null,33);f.setText(a.treasures_user),setCoor(f,418,531),l.addChild(c),l.addChild(f),l.addChild(e)}}function Instructions(){function a(g){e.removeAllChildren(),g>=0&&f>g&&(active=g),e.addChild(i[active]),l.removeAllEventListeners(),0>active-1?b?l.addEventListener("click",function(){v_choiseLocation("menu")}):c?l.addEventListener("click",function(){v_choiseLocation("pause")}):l.addEventListener("click",function(){v_choiseLocation("setting")}):l.addEventListener("click",function(){a(active-1)}),k.removeAllEventListeners(),active+1>=f?b?(k.alpha=1,k.addEventListener("click",function(){v_choiseLocation("game",d)})):k.alpha=.5:(k.alpha=1,k.addEventListener("click",function(){a(active+1)}))}this.initialize();var b,c,d,e=new createjs.Container,f=2,g=[[24,141],[23,143]],h=new createjs.Sprite(jsons.JSON2);h.gotoAndStop("text_red_instructions"),setCoor(h,220,11);for(var i=new Array,j=0;f>j;j++)i[j]=new createjs.Bitmap(images["instrimgs_"+(j+1)]),setCoor(i[j],g[j][0],g[j][1]),e.addChild(i[j]);var k=new Button({pod:"btn_loop",i:"btn_arrow",iconX:85,iconY:21,iconScaleX:-1});setCoor(k,521,603);var l=new Button({pod:"btn_loop",i:"btn_arrow",iconX:19,iconY:21});setCoor(l,18,603);var m=new FloatFrame;m.addToTopPlatform(h),m.addToBottomPlatform(k),m.addToBottomPlatform(l),this.addChild(e),this.addChild(m),this.update=function(e){b=e&&e.game?e:!1,c=e&&e.pause?e.pause:!1,e&&e.size_field&&(d={size_field:e.size_field}),a(0)}}function Menu(){this.initialize();var a=new createjs.Shape;a.graphics.beginFill("#000000").drawRect(0,0,100/__koefDisplay,100/__koefDisplay),setCoor(a,276,637),a.addEventListener("click",function(){v_choiseLocation("choise")}),a.alpha=.01;var b=new createjs.Shape;b.graphics.beginFill("#000000").drawRect(0,0,100/__koefDisplay,100/__koefDisplay),setCoor(b,504,637),b.addEventListener("click",function(){v_choiseLocation("setting")}),b.alpha=.01;var c=new createjs.Shape;c.graphics.beginFill("#000000").drawRect(0,0,100/__koefDisplay,100/__koefDisplay),c.addEventListener("click",function(){window.open(__config.url,"_blank")}),setCoor(c,35,636),c.alpha=.01;var d=new createjs.Shape;d.graphics.beginFill("#000000").drawRect(0,0,250/__koefDisplay,100/__koefDisplay),d.addEventListener("click",function(){window.open(__config.url,"_blank")}),setCoor(d,359,167),d.alpha=.01,this.addChild(a),this.addChild(b),this.addChild(c),this.addChild(d)}function Pause(){this.initialize();var a=new createjs.Container,b=new createjs.Sprite(jsons.JSON2);b.gotoAndStop("window"),b.x=WIDTHGAME/2-b.getBounds().width/2,b.y=HEIGHTGAME/2-b.getBounds().height/2;var c=new createjs.Sprite(jsons.JSON2);c.gotoAndStop("text_red_pause"),setCoor(c,256,7);var d=new createjs.Sprite(jsons.JSON2);if(d.gotoAndStop("pirot"),setCoor(d,55,455),a.addChild(b),__audio_supported){var e=new Button({pod:"btn_1",i:"icon_music_on",i2:"icon_music_off"});e.changeFrame("off"),setCoor(e,376,171),e.addEventListener("click",function(){var a=e.changeBeetweenAnim("off","on");"off"==a?MusicCTRL.off("music"):(MusicCTRL.on("music"),MusicCTRL.play("music"))}),a.addChild(e);var f=new Button({pod:"btn_1",i:"icon_sound_on",i2:"icon_sound_off"});f.changeFrame("off"),setCoor(f,110,171),f.addEventListener("click",function(){var a=f.changeBeetweenAnim("off","on");"off"==a?MusicCTRL.off("sound"):MusicCTRL.on("sound",1)}),a.addChild(f)}var g=new Button({pod:"btn",i:"icon_menu"});setCoor(g,48,222),g.addEventListener("click",function(){v_choiseLocation("menu")});var h=new Button({pod:"btn_loop",i:"btn_next",iconX:19,iconY:21});setCoor(h,434,494),h.addEventListener("click",function(){v_choiseLocation("game",{dont_update:!0,unPause:!0})}),MusicCTRL.registerObserver(this);var i=new Button({pod:"btn_1",i:"icon_info"});setCoor(i,376,409),i.x=WIDTHGAME/2-i.getBounds().width/2,i.addEventListener("click",function(){v_choiseLocation("instructions",{pause:!0})});var j=new createjs.Sprite(jsons.JSON2);j.gotoAndStop("window_crown"),setCoor(j,19,600);var k=new Button({pod:"btn_loop",i:"btn_arrow",iconX:83,iconY:20,rotateIcon:90});setCoor(k,102,522),k.addEventListener("click",function(){v_choiseLocation("yar",{par:"pause"})});var l=new Button({pod:"btn_loop",i:"btn_next",iconX:24,iconY:20});setCoor(l,437,522),l.addEventListener("click",function(){v_choiseLocation("game",{dont_update:!0,unPause:!0})});var m=new FloatFrame;m.addToTopPlatform(a,0),m.addToTopPlatform(c),m.addToTopPlatform(i),m.addToTopPlatform(j),m.addToTopPlatform(k),m.addToTopPlatform(l),this.addChild(m),this.off=function(a){"music"==a&&e.changeFrame("off"),"sound"==a&&f.changeFrame("off")},this.on=function(a){"music"==a&&e.changeFrame("on"),"sound"==a&&f.changeFrame("on")}}function Setting(){this.initialize();var a=new createjs.Container,b=new createjs.Sprite(jsons.JSON2);b.gotoAndStop("window"),b.x=WIDTHGAME/2-b.getBounds().width/2,b.y=HEIGHTGAME/2-b.getBounds().height/2;var c=new createjs.Sprite(jsons.JSON2);if(c.gotoAndStop("text_red_settings"),setCoor(c,212,4),c.x=WIDTHGAME/2-c.getBounds().width/2,a.addChild(b),__audio_supported){var d=new Button({pod:"btn_1",i:"icon_music_on",i2:"icon_music_off"});d.changeFrame("off"),setCoor(d,376,171),d.addEventListener("click",function(){var a=d.changeBeetweenAnim("off","on");"off"==a?MusicCTRL.off("music"):(MusicCTRL.on("music"),MusicCTRL.play("music"))}),a.addChild(d);var e=new Button({pod:"btn_1",i:"icon_sound_on",i2:"icon_sound_off"});e.changeFrame("off"),setCoor(e,110,171),e.addEventListener("click",function(){var a=e.changeBeetweenAnim("off","on");"off"==a?MusicCTRL.off("sound"):MusicCTRL.on("sound",1)}),a.addChild(e)}var f=new Button({pod:"btn_1",i:"icon_about"});setCoor(f,110,409),f.addEventListener("click",function(){v_choiseLocation("about")});var g=new Button({pod:"btn_1",i:"icon_info"});setCoor(g,376,409),g.addEventListener("click",function(){v_choiseLocation("instructions")});var h=new Arrow("left");setCoor(h,54,19),h.addEventListener("click",function(){v_choiseLocation("menu")});var i=new FloatFrame;i.addToTopPlatform(a,0),i.addToTopPlatform(c),i.addToTopPlatform(h),MusicCTRL.registerObserver(this),a.addChild(f),a.addChild(g),this.addChild(i),this.off=function(a){"music"==a&&d.changeFrame("off"),"sound"==a&&e.changeFrame("off")},this.on=function(a){"music"==a&&d.changeFrame("on"),"sound"==a&&e.changeFrame("on")}}function Shop(){this.initialize();var a,b,c,d=this,e=new Array,f=["life","bombs","submarine","torpedo","air_strike"],g=[[73,125],[345,125],[14,443],[217,443],[423,443]],h=new createjs.Sprite(jsons.JSON2);h.gotoAndStop("window"),h.x=WIDTHGAME/2-h.getBounds().width/2,h.y=HEIGHTGAME/2-h.getBounds().height/2;var i=new createjs.Sprite(jsons.JSON2);i.gotoAndStop("text_red_shop"),setCoor(i,140,6),i.x=WIDTHGAME/2-i.getBounds().width/2;var j=new createjs.Sprite(jsons.JSON1);j.gotoAndStop("area_money"),setCoor(j,-108,115);var k=new Button({pod:"btn_money",i:"icon_money",iconX:-1,iconY:1,txt:"0",font:"numbers_green_small_",txtX:99,txtY:42,refTxt:"Left"});setCoor(k,-2,84);var l=new Arrow("left");setCoor(l,54,19),l.addEventListener("click",function(){v_choiseLocation("game",{dont_update:!0,unPause:!0})});for(var m=0;5>m;m++){var n=new ItemShop(f[m]);setCoor(n,g[m][0],g[m][1]),n.setPrice(__config.price_bonuses[f[m]]),this.addChild(n),e.push(n)}var o=new FloatFrame;o.addToTopPlatform(i),o.addToTopPlatform(l),o.addToTopPlatform(j),o.addToTopPlatform(k),this.addChild(o),this.update=function(g){if(g&&g.logic){a=g.logic,k.setText(g.logic.getData().user_money),j.x=-133/__koefDisplay+20*g.logic.getData().user_money.toString().length/__koefDisplay,b=[a.getData().life_user,a.getData().game_data.dinamite_num_user,a.getData().game_data.periskope_num_user,a.getData().game_data.torpedo_num_user,a.getData().game_data.multibomb_num_user],c=[a.setLife,a.setNumBonus,a.setNumBonus,a.setNumBonus];for(var h=0;h<e.length;h++)e[h].setNum(b[h]),e[h].removeAllEventListeners(),e[h].addEventListener("click",function(b){a.getData().user_money>=b.target.getPrice()&&(b.target.getName()==f[0]?(a.setLife("user",1),a.setMoney("user",-b.target.getPrice())):b.target.getName()==f[1]?(a.setNumBonus("user","dinamite",1),a.setMoney("user",-b.target.getPrice())):b.target.getName()==f[2]?(a.setNumBonus("user","periscope",1),a.setMoney("user",-b.target.getPrice())):b.target.getName()==f[3]?(a.setNumBonus("user","torpedo",1),a.setMoney("user",-b.target.getPrice())):b.target.getName()==f[4]&&(a.setNumBonus("user","multibomb",1),a.setMoney("user",-b.target.getPrice()))),d.update(g),g.notify()})}}}function YouAreReady(){this.initialize();var a=null,b=null,c=new createjs.Sprite(jsons.JSON2);c.gotoAndStop("window"),c.x=WIDTHGAME/2-c.getBounds().width/2,c.y=HEIGHTGAME/2-c.getBounds().height/2;var d=new createjs.Sprite(jsons.JSON1);d.gotoAndStop("text_green_are_you_sure"),setCoor(d,133,196),d.x=WIDTHGAME/2-d.getBounds().width/2;var e=new createjs.Sprite(jsons.JSON1);e.gotoAndStop("text_red_leave"),setCoor(e,257,6);var f=new createjs.Sprite(jsons.JSON2);f.gotoAndStop("window_crown"),setCoor(f,19,600);var g=new Button({pod:"btn_loop",i:"icon_ok",iconX:-.4,iconY:-1});setCoor(g,402,485),g.addEventListener("click",function(){v_choiseLocation("menu")});var h=new Button({pod:"btn_loop",i:"icon_cancel",iconX:-.4,iconY:-1});setCoor(h,127,485),h.addEventListener("click",function(){v_choiseLocation(a,b)});var i=new FloatFrame;i.addToTopPlatform(d,0),i.addToTopPlatform(c,0),i.addToTopPlatform(f),i.addToTopPlatform(e),i.addToTopPlatform(g),i.addToTopPlatform(h),this.addChild(i),this.update=function(c){c&&c.par&&(a=c.par),c&&c.par_ret&&(b=c.par_ret)}}var lvls=new Array,__open=new Array,flag=new Array,numPlay,money,obs=new Array;ClassBezier.prototype.setObject=function(a){this.getImg=a},ClassBezier.prototype.setSpeed=function(a){this.speed=a},ClassBezier.prototype.setEveryTick=function(a){this.et=a},ClassBezier.prototype.set=function(a,b,c,d,e,f){this.t=0,this.arr=[{x:a,y:b},{x:c,y:d},{x:e,y:f}]},ClassBezier.prototype.Iter=function(a){if(this.t<1)if(this.t+=this.speed,this.t>1)a&&a();else{this.et&&this.et();for(var b=0,c=0,d=0;d<this.arr.length;d++){var e=getBezierBasis(d,this.arr.length-1,this.t);b+=this.arr[d].x*e,c+=this.arr[d].y*e}var f=this.getImg.x,g=this.getImg.y;this.getImg.rotation=180*Math.atan2(b-f,g-c)/Math.PI-90,this.getImg.x=b,this.getImg.y=c}};var field_params={dx:40/__koefDisplay,dy:30/__koefDisplay,startX_1:18/__koefDisplay,startX_2:46/__koefDisplay,startX_3:36/__koefDisplay,startX_mine:18/__koefDisplay,startX_money:-2/__koefDisplay,startX_terget:10/__koefDisplay,startX_per:20/__koefDisplay,startX_subm:37/__koefDisplay,startX_bomb:28/__koefDisplay,startX_anim_miss:-89/__koefDisplay,startX_baloon:25/__koefDisplay,startX_bottle:56/__koefDisplay,startX_bottle_r:98/__koefDisplay,startX_empty:37/__koefDisplay,startX_debris_1:20/__koefDisplay,startX_exp:-58/__koefDisplay,startX_chest:19/__koefDisplay,startX_torpedo:3/__koefDisplay,startX_dim:-27/__koefDisplay,startX_flag:21/__koefDisplay,startY_1:536/__koefDisplay,startY_2:588/__koefDisplay,startY_3:561/__koefDisplay,startY_mine:506/__koefDisplay,startY_money:460/__koefDisplay,startY_terget:458/__koefDisplay,startY_per:488/__koefDisplay,startY_subm:460/__koefDisplay,startY_bomb:488/__koefDisplay,startY_anim_miss:340/__koefDisplay,startY_baloon:243/__koefDisplay,startY_bottle:449/__koefDisplay,startY_bottle_r:472/__koefDisplay,startY_empty:528/__koefDisplay,startY_debris_1:505/__koefDisplay,startY_exp:353/__koefDisplay,startY_chest:506/__koefDisplay,startY_torpedo:381/__koefDisplay,startY_dim:410/__koefDisplay,startY_flag:515/__koefDisplay};extend(Arrow,createjs.Container),extend(Button,createjs.Container),extend(FontText,createjs.Container),extend(ProgressBar,createjs.Container),extend(ResizeTopBottom,createjs.Container),extend(StoreBoard,createjs.Container),extend(Text,createjs.Container);var m_tweem=new Array,delay=__freq,__pause,to=function(){for(var a=0;a<m_tweem.length;a++)if(!__pause||m_tweem[a].unPause){if(Math.abs(m_tweem[a].rX-m_tweem[a].o.x)<Math.abs(m_tweem[a].sX)&&!m_tweem[a].nonSt&&(m_tweem[a].sX=m_tweem[a].rX-m_tweem[a].o.x),Math.abs(m_tweem[a].rY-m_tweem[a].o.y)<Math.abs(m_tweem[a].sY)&&!m_tweem[a].nonSt&&(m_tweem[a].sY=m_tweem[a].rY-m_tweem[a].o.y),Math.abs(m_tweem[a].rScX-m_tweem[a].o.scaleX)<Math.abs(m_tweem[a].sScX)&&(m_tweem[a].sScX=m_tweem[a].rScX-m_tweem[a].o.scaleX),Math.abs(m_tweem[a].rScY-m_tweem[a].o.scaleY)<Math.abs(m_tweem[a].sScY)&&(m_tweem[a].sScY=m_tweem[a].rScY-m_tweem[a].o.scaleY),Math.abs(m_tweem[a].rAl-m_tweem[a].o.alpha)<Math.abs(m_tweem[a].sA)&&(m_tweem[a].sA=m_tweem[a].rAl-m_tweem[a].o.alpha),m_tweem[a].mass&&(m_tweem[a].time*m_tweem[a].sY>=0?(m_tweem[a].sY=m_tweem[a].time,m_tweem[a].time+=Math.abs(m_tweem[a].mass)*m_tweem[a].del_k):m_tweem[a].sY=m_tweem[a].time),m_tweem[a].o.x=m_tweem[a].o.x+m_tweem[a].sX,m_tweem[a].o.y=m_tweem[a].o.y+m_tweem[a].sY,m_tweem[a].o.scaleX=m_tweem[a].o.scaleX+m_tweem[a].sScX,m_tweem[a].o.scaleY=m_tweem[a].o.scaleY+m_tweem[a].sScY,m_tweem[a].o.alpha=m_tweem[a].o.alpha+m_tweem[a].sA,m_tweem[a].impuls)if(m_tweem[a].o.rotation=m_tweem[a].o.rotation+m_tweem[a].impuls,Math.abs(m_tweem[a].impuls)>.1){var b=.98*m_tweem[a].impuls;m_tweem[a].impuls=b}else m_tweem[a].impuls&&(m_tweem[a].impuls=!1);else m_tweem[a].speedRot&&(m_tweem[a].o.rotation=m_tweem[a].o.rotation+m_tweem[a].speedRot);if(m_tweem[a].et&&m_tweem[a].et.apply(null,m_tweem[a].pet),m_tweem[a]&&round(m_tweem[a].o.x)==round(m_tweem[a].rX)&&(round(m_tweem[a].o.y)==round(m_tweem[a].rY)||m_tweem[a].mass&&m_tweem[a].mass>0&&round(m_tweem[a].o.y)>=round(m_tweem[a].rY)||m_tweem[a].time*m_tweem[a].sY<0)&&round(m_tweem[a].o.alpha)==round(m_tweem[a].rAl)&&round(m_tweem[a].o.rotation)==round(m_tweem[a].rRotate)&&round(m_tweem[a].o.scaleX)==round(m_tweem[a].rScX)&&round(m_tweem[a].o.scaleY)==round(m_tweem[a].rScY)&&!m_tweem[a].impuls&&!m_tweem[a].nonSt){m_tweem[a].mass&&m_tweem[a].mass>0&&round(m_tweem[a].o.y)>=round(m_tweem[a].rY)&&(m_tweem[a].o.y=m_tweem[a].rY);var c,d;m_tweem[a].cb&&(c=m_tweem[a].cb,d=m_tweem[a].p),m_tweem.splice(a,1),a--,c&&c.apply(null,d)}}0==m_tweem.length&&t_delInTicker(to)},curLang="en",loc={ru:{},en:{}};localization=loc[curLang],extend(FloatFrame,ResizeTopBottom),extend(VisualGame,createjs.Container),extend(VisualInterface,createjs.Container),extend(Bomb,createjs.Container),extend(Field,createjs.Container),__tweener=new TweenerObjects,extend(BottomInterface,createjs.Container),extend(Hint,createjs.Container),extend(Modal,createjs.Container),extend(Timer,createjs.Container),extend(TopInterface,createjs.Container),extend(Tutorial,createjs.Container),extend(ItemShop,createjs.Container),extend(Mine,createjs.Container),extend(Ship,createjs.Container),extend(About,createjs.Container),extend(BonusWnd,createjs.Container),extend(ChoiseLvl,createjs.Container),extend(Game,createjs.Container),extend(GameOver,createjs.Container),extend(Instructions,createjs.Container),extend(Menu,createjs.Container),extend(Pause,createjs.Container),extend(Setting,createjs.Container),extend(Shop,createjs.Container),extend(YouAreReady,createjs.Container);